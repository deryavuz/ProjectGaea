!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(window,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=36)}([function(t,e,r){t.exports=r(37)},function(t,e){function r(t,e,r,n,i,o,a){try{var s=t[o](a),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}t.exports=function(t){return function(){var e=this,n=arguments;return new Promise((function(i,o){var a=t.apply(e,n);function s(t){r(a,i,o,s,u,"next",t)}function u(t){r(a,i,o,s,u,"throw",t)}s(void 0)}))}}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}},,function(t,e){t.exports=function(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}},function(t,e){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(t){return typeof t}:t.exports=r=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(e)}t.exports=r},function(t,e,r){var n=r(30);t.exports=function(t){return new n(t)}},function(t,e,r){"use strict";(function(t,n){r.d(e,"a",(function(){return a})),r.d(e,"b",(function(){return s})),r.d(e,"c",(function(){return c}));var i=r(6),o={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document},a=o.global||o.self||o.window,s="object"!==(void 0===n?"undefined":r.n(i)()(n))||"[object process]"!==String(n)||n.browser,u=void 0!==n&&n.version&&n.version.match(/v([0-9]*)/),c=u&&parseFloat(u[1])||0}).call(this,r(26),r(27))},function(t,e,r){var n=r(38),i=r(39),o=r(28),a=r(40);t.exports=function(t,e){return n(t)||i(t,e)||o(t,e)||a()}},function(t,e,r){var n=r(41),i=r(42),o=r(28),a=r(43);t.exports=function(t){return n(t)||i(t)||o(t)||a()}},function(t,e,r){var n=r(44);t.exports=function(t){return function(){return new n(t.apply(this,arguments))}}},function(t,e){function r(e){return t.exports=r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},r(e)}t.exports=r},,function(t,e,r){"use strict";(function(t){function n(){var e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if(void 0!==t&&t.hrtime){var r=t.hrtime();e=1e3*r[0]+r[1]/1e6}else e=Date.now();return e}r.d(e,"a",(function(){return n}))}).call(this,r(27))},,function(t,e){t.exports=function(t){var e;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(e=t[Symbol.asyncIterator]))return e.call(t);if(Symbol.iterator&&null!=(e=t[Symbol.iterator]))return e.call(t)}throw new TypeError("Object is not async iterable")}},function(t,e,r){var n=r(45);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}},function(t,e,r){var n=r(6),i=r(46);t.exports=function(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?i(t):e}},,,function(t,e){},,,,,function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){var r,n,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(r===setTimeout)return setTimeout(t,0);if((r===o||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:o}catch(t){r=o}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(t){n=a}}();var u,c=[],h=!1,l=-1;function f(){h&&u&&(h=!1,u.length?c=u.concat(c):l=-1,c.length&&y())}function y(){if(!h){var t=s(f);h=!0;for(var e=c.length;e;){for(u=c,c=[];++l<e;)u&&u[l].run();l=-1,e=c.length}u=null,h=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function v(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new p(t,e)),1!==c.length||h||s(y)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,r){var n=r(29);t.exports=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}},function(t,e){t.exports=function(t){this.wrapped=t}},,,,,,function(t,e,r){(function(e){var n=r(47),i="undefined"==typeof window?e:window;i.loaders=i.loaders||{},t.exports=Object.assign(i.loaders,n)}).call(this,r(26))},function(t,e,r){var n=function(t){"use strict";var e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var i=e&&e.prototype instanceof l?e:l,o=Object.create(i.prototype),a=new x(n||[]);return o._invoke=function(t,e,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return T()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=k(a,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,a),o}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var h={};function l(){}function f(){}function y(){}var p={};p[i]=function(){return this};var v=Object.getPrototypeOf,d=v&&v(v(S([])));d&&d!==e&&r.call(d,i)&&(p=d);var m=y.prototype=l.prototype=Object.create(p);function g(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){var n;this._invoke=function(i,o){function a(){return new e((function(n,a){!function n(i,o,a,s){var u=c(t[i],t,o);if("throw"!==u.type){var h=u.arg,l=h.value;return l&&"object"==typeof l&&r.call(l,"__await")?e.resolve(l.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(l).then((function(t){h.value=t,a(h)}),(function(t){return n("throw",t,a,s)}))}s(u.arg)}(i,o,n,a)}))}return n=n?n.then(a,a):a()}}function k(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method))return h;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var n=c(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,h;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function w(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function _(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(w,this),this.reset(!0)}function S(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:T}}function T(){return{value:void 0,done:!0}}return f.prototype=m.constructor=y,y.constructor=f,f.displayName=s(y,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,s(t,a,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},g(b.prototype),b.prototype[o]=function(){return this},t.AsyncIterator=b,t.async=function(e,r,n,i,o){void 0===o&&(o=Promise);var a=new b(u(e,r,n,i),o);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},g(m),s(m,a,"Generator"),m[i]=function(){return this},m.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=S,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(_),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),_(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;_(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}(t.exports);try{regeneratorRuntime=n}catch(t){Function("r","regeneratorRuntime = r")(n)}},function(t,e){t.exports=function(t){if(Array.isArray(t))return t}},function(t,e){t.exports=function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,r){var n=r(29);t.exports=function(t){if(Array.isArray(t))return n(t)}},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,r){var n=r(30);function i(t){var e,r;function i(e,r){try{var a=t[e](r),s=a.value,u=s instanceof n;Promise.resolve(u?s.wrapped:s).then((function(t){u?i("return"===e?"return":"next",t):o(a.done?"return":"normal",t)}),(function(t){i("throw",t)}))}catch(t){o("throw",t)}}function o(t,n){switch(t){case"return":e.resolve({value:n,done:!0});break;case"throw":e.reject(n);break;default:e.resolve({value:n,done:!1})}(e=e.next)?i(e.key,e.arg):r=null}this._invoke=function(t,n){return new Promise((function(o,a){var s={key:t,arg:n,resolve:o,reject:a,next:null};r?r=r.next=s:(e=r=s,i(t,n))}))},"function"!=typeof t.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(i.prototype[Symbol.asyncIterator]=function(){return this}),i.prototype.next=function(t){return this._invoke("next",t)},i.prototype.throw=function(t){return this._invoke("throw",t)},i.prototype.return=function(t){return this._invoke("return",t)},t.exports=i},function(t,e){function r(e,n){return t.exports=r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(e,n)}t.exports=r},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e,r){"use strict";r.r(e),r.d(e,"Tileset3D",(function(){return ga})),r.d(e,"Tile3D",(function(){return Uo})),r.d(e,"TilesetTraverser",(function(){return ta})),r.d(e,"TilesetCache",(function(){return ve})),r.d(e,"createBoundingVolume",(function(){return Ro})),r.d(e,"calculateTransformProps",(function(){return de})),r.d(e,"getFrameState",(function(){return Br})),r.d(e,"TILE_CONTENT_STATE",(function(){return bo})),r.d(e,"TILE_REFINEMENT",(function(){return ko})),r.d(e,"TILE_TYPE",(function(){return wo})),r.d(e,"TILESET_TYPE",(function(){return _o})),r.d(e,"LOD_METRIC_TYPE",(function(){return xo}));var n={};r.r(n),r.d(n,"dirname",(function(){return se}));var i=r(0),o=r.n(i),a=r(1),s=r.n(a),u=r(5),c=r.n(u),h=r(2),l=r.n(h),f=r(3),y=r.n(f);function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function v(t,e){if(t){if("string"==typeof t)return p(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?p(t,e):void 0}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var r=[],n=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(n=(a=s.next()).done)&&(r.push(a.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{n||null==s.return||s.return()}finally{if(i)throw o}}return r}}(t,e)||v(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function g(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function b(t,e,r){return e&&g(t.prototype,e),r&&g(t,r),t}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function w(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}function _(t){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function x(t,e){return!e||"object"!==_(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function S(t){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function T(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function O(t,e,r){return(O=T()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&k(i,r.prototype),i}).apply(null,arguments)}function E(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||v(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}var A=1/Math.PI*180,P=1/180*Math.PI,R={};function j(t){return Math.round(t/R.EPSILON)*R.EPSILON}function C(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.precision,n=void 0===r?R.precision||4:r;return t=j(t),"".concat(parseFloat(t.toPrecision(n)))}function D(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function N(t,e,r){if(D(t)){r=r||((i=t).clone?i.clone():new Array(i.length));for(var n=0;n<r.length&&n<t.length;++n)r[n]=e(t[n],n,r);return r}var i;return e(t)}function I(t){return function(t,e){return N(t,(function(t){return t*P}),e)}(t)}function L(t){return q(t)}function q(t,e){return N(t,(function(t){return t*A}),e)}function V(t,e,r){var n=R.EPSILON;r&&(R.EPSILON=r);try{if(t===e)return!0;if(D(t)&&D(e)){if(t.length!==e.length)return!1;for(var i=0;i<t.length;++i)if(!V(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):!(!Number.isFinite(t)||!Number.isFinite(e))&&Math.abs(t-e)<=R.EPSILON*Math.max(1,Math.abs(t),Math.abs(e))}finally{R.EPSILON=n}}function z(t,e){if(t.length!==e)return!1;for(var r=0;r<t.length;++r)if(!Number.isFinite(t[r]))return!1;return!0}function U(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function F(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(R.debug&&!z(t,e))throw new Error("math.gl: ".concat(r," some fields set to invalid numbers'"));return t}R.EPSILON=1e-12,R.debug=!1,R.precision=4,R.printTypes=!1,R.printDegrees=!1,R.printRowMajor=!0;var W={};function B(t,e){W[t]||(W[t]=!0,console.warn("".concat(t," has been removed in version ").concat(e,", see upgrade guide for more information")))}function G(t){var e="function"==typeof Map?new Map:void 0;return(G=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return O(t,arguments,S(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),k(n,t)})(t)}function Q(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=S(t);if(e){var i=S(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x(this,r)}}var Y=function(t){w(r,t);var e=Q(r);function r(){return m(this,r),e.apply(this,arguments)}return b(r,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"from",value:function(t){return Array.isArray(t)?this.copy(t):this.fromObject(t)}},{key:"fromArray",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)this[r]=t[r+e];return this.check()}},{key:"to",value:function(t){return t===this?this:D(t)?this.toArray(t):this.toObject(t)}},{key:"toTarget",value:function(t){return t?this.to(t):this}},{key:"toArray",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;r<this.ELEMENTS;++r)t[e+r]=this[r];return t}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(R)}},{key:"formatString",value:function(t){for(var e="",r=0;r<this.ELEMENTS;++r)e+=(r>0?", ":"")+C(this[r],t);return"".concat(t.printTypes?this.constructor.name:"","[").concat(e,"]")}},{key:"equals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(!V(this[e],t[e]))return!1;return!0}},{key:"exactEquals",value:function(t){if(!t||this.length!==t.length)return!1;for(var e=0;e<this.ELEMENTS;++e)if(this[e]!==t[e])return!1;return!0}},{key:"negate",value:function(){for(var t=0;t<this.ELEMENTS;++t)this[t]=-this[t];return this.check()}},{key:"lerp",value:function(t,e,r){void 0===r&&(r=e,e=t,t=this);for(var n=0;n<this.ELEMENTS;++n){var i=t[n];this[n]=i+r*(e[n]-i)}return this.check()}},{key:"min",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.min(t[e],this[e]);return this.check()}},{key:"max",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=Math.max(t[e],this[e]);return this.check()}},{key:"clamp",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t[r]),e[r]);return this.check()}},{key:"add",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var o=i[n],a=0;a<this.ELEMENTS;++a)this[a]+=o[a];return this.check()}},{key:"subtract",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var o=i[n],a=0;a<this.ELEMENTS;++a)this[a]-=o[a];return this.check()}},{key:"scale",value:function(t){if(Array.isArray(t))return this.multiply(t);for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"sub",value:function(t){return this.subtract(t)}},{key:"setScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]=t;return this.check()}},{key:"addScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]+=t;return this.check()}},{key:"subScalar",value:function(t){return this.addScalar(-t)}},{key:"multiplyScalar",value:function(t){for(var e=0;e<this.ELEMENTS;++e)this[e]*=t;return this.check()}},{key:"divideScalar",value:function(t){return this.scale(1/t)}},{key:"clampScalar",value:function(t,e){for(var r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],t),e);return this.check()}},{key:"multiplyByScalar",value:function(t){return this.scale(t)}},{key:"check",value:function(){if(R.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var t=this.length===this.ELEMENTS,e=0;e<this.ELEMENTS;++e)t=t&&Number.isFinite(this[e]);return t}},{key:"ELEMENTS",get:function(){return M(!1),0}},{key:"RANK",get:function(){return M(!1),0}},{key:"elements",get:function(){return this}}]),r}(G(Array));function K(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=S(t);if(e){var i=S(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x(this,r)}}var Z=function(t){w(r,t);var e=K(r);function r(){return m(this,r),e.apply(this,arguments)}return b(r,[{key:"toString",value:function(){var t="[";if(R.printRowMajor){t+="row-major:";for(var e=0;e<this.RANK;++e)for(var r=0;r<this.RANK;++r)t+=" ".concat(this[r*this.RANK+e])}else{t+="column-major:";for(var n=0;n<this.ELEMENTS;++n)t+=" ".concat(this[n])}return t+="]"}},{key:"getElementIndex",value:function(t,e){return e*this.RANK+t}},{key:"getElement",value:function(t,e){return this[e*this.RANK+t]}},{key:"setElement",value:function(t,e,r){return this[e*this.RANK+t]=U(r),this}},{key:"getColumn",value:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),r=t*this.RANK,n=0;n<this.RANK;++n)e[n]=this[r+n];return e}},{key:"setColumn",value:function(t,e){for(var r=t*this.RANK,n=0;n<this.RANK;++n)this[r+n]=e[n];return this}}]),r}(Y);function X(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[3]*n+r[7]*i+r[11]*o||1;return t[0]=(r[0]*n+r[4]*i+r[8]*o)/a,t[1]=(r[1]*n+r[5]*i+r[9]*o)/a,t[2]=(r[2]*n+r[6]*i+r[10]*o)/a,t}var H=1e-6,$="undefined"!=typeof Float32Array?Float32Array:Array;Math.random;Math.PI;function J(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],y=e[10],p=e[11],v=e[12],d=e[13],m=e[14],g=e[15],b=r[0],k=r[1],w=r[2],_=r[3];return t[0]=b*n+k*s+w*l+_*v,t[1]=b*i+k*u+w*f+_*d,t[2]=b*o+k*c+w*y+_*m,t[3]=b*a+k*h+w*p+_*g,b=r[4],k=r[5],w=r[6],_=r[7],t[4]=b*n+k*s+w*l+_*v,t[5]=b*i+k*u+w*f+_*d,t[6]=b*o+k*c+w*y+_*m,t[7]=b*a+k*h+w*p+_*g,b=r[8],k=r[9],w=r[10],_=r[11],t[8]=b*n+k*s+w*l+_*v,t[9]=b*i+k*u+w*f+_*d,t[10]=b*o+k*c+w*y+_*m,t[11]=b*a+k*h+w*p+_*g,b=r[12],k=r[13],w=r[14],_=r[15],t[12]=b*n+k*s+w*l+_*v,t[13]=b*i+k*u+w*f+_*d,t[14]=b*o+k*c+w*y+_*m,t[15]=b*a+k*h+w*p+_*g,t}function tt(t,e,r){var n=r[0],i=r[1],o=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function et(t,e){var r=e[0],n=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],c=e[9],h=e[10];return t[0]=Math.hypot(r,n,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,c,h),t}function rt(t,e,r,n,i){var o,a=1/Math.tan(e/2);return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(n-i),t[10]=(i+n)*o,t[14]=2*i*n*o):(t[10]=-1,t[14]=-2*n),t}function nt(t,e,r,n){var i,o,a,s,u,c,h,l,f,y,p=e[0],v=e[1],d=e[2],m=n[0],g=n[1],b=n[2],k=r[0],w=r[1],_=r[2];return Math.abs(p-k)<H&&Math.abs(v-w)<H&&Math.abs(d-_)<H?function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t):(h=p-k,l=v-w,f=d-_,i=g*(f*=y=1/Math.hypot(h,l,f))-b*(l*=y),o=b*(h*=y)-m*f,a=m*l-g*h,(y=Math.hypot(i,o,a))?(i*=y=1/y,o*=y,a*=y):(i=0,o=0,a=0),s=l*a-f*o,u=f*i-h*a,c=h*o-l*i,(y=Math.hypot(s,u,c))?(s*=y=1/y,u*=y,c*=y):(s=0,u=0,c=0),t[0]=i,t[1]=s,t[2]=h,t[3]=0,t[4]=o,t[5]=u,t[6]=l,t[7]=0,t[8]=a,t[9]=c,t[10]=f,t[11]=0,t[12]=-(i*p+o*v+a*d),t[13]=-(s*p+u*v+c*d),t[14]=-(h*p+l*v+f*d),t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var it,ot;it=new $(2),$!=Float32Array&&(it[0]=0,it[1]=0),ot=it;function at(){var t=new $(3);return $!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function st(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function ut(t,e,r){var n=new $(3);return n[0]=t,n[1]=e,n[2]=r,n}function ct(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ht(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2];return t[0]=i*u-o*s,t[1]=o*a-n*u,t[2]=n*s-i*a,t}function lt(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return a=a||1,t[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/a,t[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,t[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,t}function ft(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=n*r[0]+i*r[3]+o*r[6],t[1]=n*r[1]+i*r[4]+o*r[7],t[2]=n*r[2]+i*r[5]+o*r[8],t}var yt=st;!function(){var t=at()}();function pt(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.hypot(e,r,n,i)}function vt(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function dt(t,e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2],c=r[3],h=c*n+s*o-u*i,l=c*i+u*n-a*o,f=c*o+a*i-s*n,y=-a*n-s*i-u*o;return t[0]=h*c+y*-a+l*-u-f*-s,t[1]=l*c+y*-s+f*-a-h*-u,t[2]=f*c+y*-u+h*-s-l*-a,t[3]=e[3],t}!function(){var t=function(){var t=new $(4);return $!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}()}();function mt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=S(t);if(e){var i=S(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x(this,r)}}var gt=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),bt=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),kt=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),wt={},_t=function(t){w(r,t);var e=mt(r);function r(t){var n;return m(this,r),n=e.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?n.copy(t):n.identity(),n}return b(r,[{key:"INDICES",get:function(){return kt}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}}],[{key:"IDENTITY",get:function(){return wt.IDENTITY=wt.IDENTITY||Object.freeze(new r(gt)),wt.IDENTITY}},{key:"ZERO",get:function(){return wt.ZERO=wt.ZERO||Object.freeze(new r(bt)),wt.ZERO}}]),b(r,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this[9]=t[9],this[10]=t[10],this[11]=t[11],this[12]=t[12],this[13]=t[13],this[14]=t[14],this[15]=t[15],this.check()}},{key:"set",value:function(t,e,r,n,i,o,a,s,u,c,h,l,f,y,p,v){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=o,this[6]=a,this[7]=s,this[8]=u,this[9]=c,this[10]=h,this[11]=l,this[12]=f,this[13]=y,this[14]=p,this[15]=v,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,o,a,s,u,c,h,l,f,y,p,v){return this[0]=t,this[1]=i,this[2]=u,this[3]=f,this[4]=e,this[5]=o,this[6]=c,this[7]=y,this[8]=r,this[9]=a,this[10]=h,this[11]=p,this[12]=n,this[13]=s,this[14]=l,this[15]=v,this.check()}},{key:"toRowMajor",value:function(t){return t[0]=this[0],t[1]=this[4],t[2]=this[8],t[3]=this[12],t[4]=this[1],t[5]=this[5],t[6]=this[9],t[7]=this[13],t[8]=this[2],t[9]=this[6],t[10]=this[10],t[11]=this[14],t[12]=this[3],t[13]=this[7],t[14]=this[11],t[15]=this[15],t}},{key:"identity",value:function(){return this.copy(gt)}},{key:"fromQuaternion",value:function(t){return function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,u=i+i,c=r*a,h=n*a,l=n*s,f=i*a,y=i*s,p=i*u,v=o*a,d=o*s,m=o*u;t[0]=1-l-p,t[1]=h+m,t[2]=f-d,t[3]=0,t[4]=h-m,t[5]=1-c-p,t[6]=y+v,t[7]=0,t[8]=f+d,t[9]=y-v,t[10]=1-c-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1}(this,t),this.check()}},{key:"frustum",value:function(t){var e=t.left,n=t.right,i=t.bottom,o=t.top,a=t.near,s=t.far;return s===1/0?r._computeInfinitePerspectiveOffCenter(this,e,n,i,o,a):function(t,e,r,n,i,o,a){var s=1/(r-e),u=1/(i-n),c=1/(o-a);t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0}(this,e,n,i,o,a,s),this.check()}},{key:"lookAt",value:function(t,e,r){if(1===arguments.length){var n=t;t=n.eye,e=n.center,r=n.up}return nt(this,t,e=e||[0,0,0],r=r||[0,1,0]),this.check()}},{key:"ortho",value:function(t){var e=t.left,r=t.right,n=t.bottom,i=t.top,o=t.near,a=void 0===o?.1:o,s=t.far;return function(t,e,r,n,i,o,a){var s=1/(e-r),u=1/(n-i),c=1/(o-a);t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(a+o)*c,t[15]=1}(this,e,r,n,i,a,void 0===s?500:s),this.check()}},{key:"orthographic",value:function(t){var e=t.fovy,n=void 0===e?45*Math.PI/180:e,i=t.aspect,o=void 0===i?1:i,a=t.focalDistance,s=void 0===a?1:a,u=t.near,c=void 0===u?.1:u,h=t.far,l=void 0===h?500:h;if(n>2*Math.PI)throw Error("radians");var f=n/2,y=s*Math.tan(f),p=y*o;return(new r).ortho({left:-p,right:p,bottom:-y,top:y,near:c,far:l})}},{key:"perspective",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.fovy,r=void 0===e?void 0:e,n=t.fov,i=void 0===n?45*Math.PI/180:n,o=t.aspect,a=void 0===o?1:o,s=t.near,u=void 0===s?.1:s,c=t.far,h=void 0===c?500:c;if((r=r||i)>2*Math.PI)throw Error("radians");return rt(this,r,a,u,h),this.check()}},{key:"determinant",value:function(){return e=(t=this)[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],h=t[9],l=t[10],f=t[11],y=t[12],p=t[13],v=t[14],d=t[15],(e*a-r*o)*(l*d-f*v)-(e*s-n*o)*(h*d-f*p)+(e*u-i*o)*(h*v-l*p)+(r*s-n*a)*(c*d-f*y)-(r*u-i*a)*(c*v-l*y)+(n*u-i*s)*(c*p-h*y);var t,e,r,n,i,o,a,s,u,c,h,l,f,y,p,v,d}},{key:"getScale",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),t[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),t[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),t}},{key:"getTranslation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return t[0]=this[12],t[1]=this[13],t[2]=this[14],t}},{key:"getRotation",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],o=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=0,t[4]=this[4]*n,t[5]=this[5]*i,t[6]=this[6]*o,t[7]=0,t[8]=this[8]*n,t[9]=this[9]*i,t[10]=this[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}},{key:"getRotationMatrix3",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.getScale(e||[-0,-0,-0]),n=1/r[0],i=1/r[1],o=1/r[2];return t[0]=this[0]*n,t[1]=this[1]*i,t[2]=this[2]*o,t[3]=this[4]*n,t[4]=this[5]*i,t[5]=this[6]*o,t[6]=this[8]*n,t[7]=this[9]*i,t[8]=this[10]*o,t}},{key:"transpose",value:function(){return function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=e[9],f=e[10],y=e[11],p=e[12],v=e[13],d=e[14],m=e[15],g=r*s-n*a,b=r*u-i*a,k=r*c-o*a,w=n*u-i*s,_=n*c-o*s,x=i*c-o*u,S=h*v-l*p,T=h*d-f*p,O=h*m-y*p,E=l*d-f*v,M=l*m-y*v,A=f*m-y*d,P=g*A-b*M+k*E+w*O-_*T+x*S;P&&(P=1/P,t[0]=(s*A-u*M+c*E)*P,t[1]=(i*M-n*A-o*E)*P,t[2]=(v*x-d*_+m*w)*P,t[3]=(f*_-l*x-y*w)*P,t[4]=(u*O-a*A-c*T)*P,t[5]=(r*A-i*O+o*T)*P,t[6]=(d*k-p*x-m*b)*P,t[7]=(h*x-f*k+y*b)*P,t[8]=(a*M-s*O+c*S)*P,t[9]=(n*O-r*M-o*S)*P,t[10]=(p*_-v*k+m*g)*P,t[11]=(l*k-h*_-y*g)*P,t[12]=(s*T-a*E-u*S)*P,t[13]=(r*E-n*T+i*S)*P,t[14]=(v*b-p*w-d*g)*P,t[15]=(h*w-l*b+f*g)*P)}(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return J(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return J(this,this,t),this.check()}},{key:"rotateX",value:function(t){return function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],h=e[9],l=e[10],f=e[11];e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*n,t[5]=a*i+h*n,t[6]=s*i+l*n,t[7]=u*i+f*n,t[8]=c*i-o*n,t[9]=h*i-a*n,t[10]=l*i-s*n,t[11]=f*i-u*n}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],c=e[8],h=e[9],l=e[10],f=e[11];e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-c*n,t[1]=a*i-h*n,t[2]=s*i-l*n,t[3]=u*i-f*n,t[8]=o*n+c*i,t[9]=a*n+h*i,t[10]=s*n+l*i,t[11]=u*n+f*i}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,r){var n=Math.sin(r),i=Math.cos(r),o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],h=e[5],l=e[6],f=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*n,t[1]=a*i+h*n,t[2]=s*i+l*n,t[3]=u*i+f*n,t[4]=c*i-o*n,t[5]=h*i-a*n,t[6]=l*i-s*n,t[7]=f*i-u*n}(this,this,t),this.check()}},{key:"rotateXYZ",value:function(t){var e=d(t,3),r=e[0],n=e[1],i=e[2];return this.rotateX(r).rotateY(n).rotateZ(i)}},{key:"rotateAxis",value:function(t,e){return function(t,e,r,n){var i,o,a,s,u,c,h,l,f,y,p,v,d,m,g,b,k,w,_,x,S,T,O,E,M=n[0],A=n[1],P=n[2],R=Math.hypot(M,A,P);R<H||(M*=R=1/R,A*=R,P*=R,i=Math.sin(r),a=1-(o=Math.cos(r)),s=e[0],u=e[1],c=e[2],h=e[3],l=e[4],f=e[5],y=e[6],p=e[7],v=e[8],d=e[9],m=e[10],g=e[11],b=M*M*a+o,k=A*M*a+P*i,w=P*M*a-A*i,_=M*A*a-P*i,x=A*A*a+o,S=P*A*a+M*i,T=M*P*a+A*i,O=A*P*a-M*i,E=P*P*a+o,t[0]=s*b+l*k+v*w,t[1]=u*b+f*k+d*w,t[2]=c*b+y*k+m*w,t[3]=h*b+p*k+g*w,t[4]=s*_+l*x+v*S,t[5]=u*_+f*x+d*S,t[6]=c*_+y*x+m*S,t[7]=h*_+p*x+g*S,t[8]=s*T+l*O+v*E,t[9]=u*T+f*O+d*E,t[10]=c*T+y*O+m*E,t[11]=h*T+p*O+g*E,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]))}(this,this,t,e),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?tt(this,this,t):tt(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return function(t,e,r){var n,i,o,a,s,u,c,h,l,f,y,p,v=r[0],d=r[1],m=r[2];e===t?(t[12]=e[0]*v+e[4]*d+e[8]*m+e[12],t[13]=e[1]*v+e[5]*d+e[9]*m+e[13],t[14]=e[2]*v+e[6]*d+e[10]*m+e[14],t[15]=e[3]*v+e[7]*d+e[11]*m+e[15]):(n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=e[9],y=e[10],p=e[11],t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=h,t[8]=l,t[9]=f,t[10]=y,t[11]=p,t[12]=n*v+s*d+l*m+e[12],t[13]=i*v+u*d+f*m+e[13],t[14]=o*v+c*d+y*m+e[14],t[15]=a*v+h*d+p*m+e[15])}(this,this,t),this.check()}},{key:"transform",value:function(t,e){return 4===t.length?(F(e=function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,t[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,t[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,t[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,t}(e||[-0,-0,-0,-0],t,this),4),e):this.transformAsPoint(t,e)}},{key:"transformAsPoint",value:function(t,e){switch(t.length){case 2:e=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}(e||[-0,-0],t,this);break;case 3:e=lt(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return F(e,t.length),e}},{key:"transformAsVector",value:function(t,e){switch(t.length){case 2:e=function(t,e,r){var n=e[0],i=e[1],o=r[3]*n+r[7]*i||1;return t[0]=(r[0]*n+r[4]*i)/o,t[1]=(r[1]*n+r[5]*i)/o,t}(e||[-0,-0],t,this);break;case 3:e=X(e||[-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return F(e,t.length),e}},{key:"makeRotationX",value:function(t){return this.identity().rotateX(t)}},{key:"makeTranslation",value:function(t,e,r){return this.identity().translate([t,e,r])}},{key:"transformPoint",value:function(t,e){return B("Matrix4.transformPoint","3.0"),this.transformAsPoint(t,e)}},{key:"transformVector",value:function(t,e){return B("Matrix4.transformVector","3.0"),this.transformAsPoint(t,e)}},{key:"transformDirection",value:function(t,e){return B("Matrix4.transformDirection","3.0"),this.transformAsVector(t,e)}}],[{key:"_computeInfinitePerspectiveOffCenter",value:function(t,e,r,n,i,o){var a=2*o/(r-e),s=2*o/(i-n),u=(r+e)/(r-e),c=(i+n)/(i-n),h=-2*o;return t[0]=a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=u,t[9]=c,t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}}]),r}(Z);function xt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=S(t);if(e){var i=S(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x(this,r)}}var St=function(t){w(r,t);var e=xt(r);function r(){return m(this,r),e.apply(this,arguments)}return b(r,[{key:"copy",value:function(t){return M(!1),this}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var t=0,e=0;e<this.ELEMENTS;++e)t+=this[e]*this[e];return t}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(t){return Math.sqrt(this.distanceSquared(t))}},{key:"distanceSquared",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r){var n=this[r]-t[r];e+=n*n}return U(e)}},{key:"dot",value:function(t){for(var e=0,r=0;r<this.ELEMENTS;++r)e+=this[r]*t[r];return U(e)}},{key:"normalize",value:function(){var t=this.magnitude();if(0!==t)for(var e=0;e<this.ELEMENTS;++e)this[e]/=t;return this.check()}},{key:"multiply",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var o=i[n],a=0;a<this.ELEMENTS;++a)this[a]*=o[a];return this.check()}},{key:"divide",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(var n=0,i=e;n<i.length;n++)for(var o=i[n],a=0;a<this.ELEMENTS;++a)this[a]/=o[a];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(t){return this.distance(t)}},{key:"distanceToSquared",value:function(t){return this.distanceSquared(t)}},{key:"getComponent",value:function(t){return M(t>=0&&t<this.ELEMENTS,"index is out of range"),U(this[t])}},{key:"setComponent",value:function(t,e){return M(t>=0&&t<this.ELEMENTS,"index is out of range"),this[t]=e,this.check()}},{key:"addVectors",value:function(t,e){return this.copy(t).add(e)}},{key:"subVectors",value:function(t,e){return this.copy(t).subtract(e)}},{key:"multiplyVectors",value:function(t,e){return this.copy(t).multiply(e)}},{key:"addScaledVector",value:function(t,e){return this.add(new this.constructor(t).multiplyScalar(e))}},{key:"x",get:function(){return this[0]},set:function(t){this[0]=U(t)}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=U(t)}}]),r}(Y);function Tt(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=S(t);if(e){var i=S(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x(this,r)}}var Ot=[0,0,0],Et={},Mt=function(t){w(r,t);var e=Tt(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return m(this,r),t=e.call(this,-0,-0,-0),1===arguments.length&&D(n)?t.copy(n):(R.debug&&(U(n),U(i),U(o)),t[0]=n,t[1]=i,t[2]=o),t}return b(r,null,[{key:"ZERO",get:function(){return Et.ZERO=Et.ZERO||Object.freeze(new r(0,0,0,0))}}]),b(r,[{key:"set",value:function(t,e,r){return this[0]=t,this[1]=e,this[2]=r,this.check()}},{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this.check()}},{key:"fromObject",value:function(t){return R.debug&&(U(t.x),U(t.y),U(t.z)),this[0]=t.x,this[1]=t.y,this[2]=t.z,this.check()}},{key:"toObject",value:function(t){return t.x=this[0],t.y=this[1],t.z=this[2],t}},{key:"angle",value:function(t){return r=t,n=(e=this)[0],i=e[1],o=e[2],a=r[0],s=r[1],u=r[2],c=Math.sqrt(n*n+i*i+o*o)*Math.sqrt(a*a+s*s+u*u),h=c&&ct(e,r)/c,Math.acos(Math.min(Math.max(h,-1),1));var e,r,n,i,o,a,s,u,c,h}},{key:"cross",value:function(t){return ht(this,this,t),this.check()}},{key:"rotateX",value:function(t){var e=t.radians,r=t.origin;return function(t,e,r,n){var i=[],o=[];i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0],o[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),o[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2]}(this,this,void 0===r?Ot:r,e),this.check()}},{key:"rotateY",value:function(t){var e=t.radians,r=t.origin;return function(t,e,r,n){var i=[],o=[];i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),o[1]=i[1],o[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2]}(this,this,void 0===r?Ot:r,e),this.check()}},{key:"rotateZ",value:function(t){var e=t.radians,r=t.origin;return function(t,e,r,n){var i=[],o=[];i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],o[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),o[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),o[2]=i[2],t[0]=o[0]+r[0],t[1]=o[1]+r[1],t[2]=o[2]+r[2]}(this,this,void 0===r?Ot:r,e),this.check()}},{key:"transform",value:function(t){return this.transformAsPoint(t)}},{key:"transformAsPoint",value:function(t){return lt(this,this,t),this.check()}},{key:"transformAsVector",value:function(t){return X(this,this,t),this.check()}},{key:"transformByMatrix3",value:function(t){return ft(this,this,t),this.check()}},{key:"transformByMatrix2",value:function(t){return function(t,e,r){var n=e[0],i=e[1];t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t[2]=e[2]}(this,this,t),this.check()}},{key:"transformByQuaternion",value:function(t){return function(t,e,r){var n=r[0],i=r[1],o=r[2],a=r[3],s=e[0],u=e[1],c=e[2],h=i*c-o*u,l=o*s-n*c,f=n*u-i*s,y=i*f-o*l,p=o*h-n*f,v=n*l-i*h,d=2*a;h*=d,l*=d,f*=d,y*=2,p*=2,v*=2,t[0]=s+h+y,t[1]=u+l+p,t[2]=c+f+v}(this,this,t),this.check()}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=U(t)}}]),r}(St),At=.1,Pt=1e-12,Rt=1e-15,jt=(Math.PI,Math.PI,Math.PI,Math.PI,Math.max(6378137,6378137,6356752.314245179),function(t){return t}),Ct=new Mt;function Dt(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jt;return D(t)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in t?(e[0]=r(t.longitude),e[1]=r(t.latitude),e[2]=t.height):(e[0]=r(t.x),e[1]=r(t.y),e[2]=t.z),e}function Nt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ct;return Dt(t,e,R._cartographicRadians?jt:I)}function It(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jt;return D(e)?(e[0]=r(t[0]),e[1]=r(t[1]),e[2]=t[2]):"longitude"in e?(e.longitude=r(t[0]),e.latitude=r(t[1]),e.height=t[2]):(e.x=r(t[0]),e.y=r(t[1]),e.z=t[2]),e}function Lt(t,e){return It(t,e,R._cartographicRadians?jt:L)}var qt=new Mt,Vt=new Mt,zt=new Mt;var Ut=new Mt,Ft={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Wt={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Bt={east:new Mt,north:new Mt,up:new Mt,west:new Mt,south:new Mt,down:new Mt},Gt=new Mt,Qt=new Mt,Yt=new Mt;function Kt(t,e,r,n,i,o){var a,s,u,c=Ft[e]&&Ft[e][r];M(c&&(!n||n===c));var h=Ut.copy(i);if(V(h.x,0,1e-14)&&V(h.y,0,1e-14)){var l=Math.sign(h.z);a=Gt.fromArray(Wt[e]),"east"!==e&&"west"!==e&&a.scale(l),s=Qt.fromArray(Wt[r]),"east"!==r&&"west"!==r&&s.scale(l),u=Yt.fromArray(Wt[n]),"east"!==n&&"west"!==n&&u.scale(l)}else{var f=Bt.up,y=Bt.east,p=Bt.north;y.set(-h.y,h.x,0).normalize(),t.geodeticSurfaceNormal(h,f),p.copy(f).cross(y);var v=Bt.west,d=Bt.south;Bt.down.copy(f).scale(-1),v.copy(y).scale(-1),d.copy(p).scale(-1),a=Bt[e],s=Bt[r],u=Bt[n]}return o[0]=a.x,o[1]=a.y,o[2]=a.z,o[3]=0,o[4]=s.x,o[5]=s.y,o[6]=s.z,o[7]=0,o[8]=u.x,o[9]=u.y,o[10]=u.z,o[11]=0,o[12]=h.x,o[13]=h.y,o[14]=h.z,o[15]=1,o}var Zt,Xt=new Mt,Ht=new Mt,$t=new Mt,Jt=new Mt,te=new Mt,ee=new Mt,re=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;m(this,t),M(e>=0),M(r>=0),M(n>=0),this.radii=new Mt(e,r,n),this.radiiSquared=new Mt(e*e,r*r,n*n),this.radiiToTheFourth=new Mt(e*e*e*e,r*r*r*r,n*n*n*n),this.oneOverRadii=new Mt(0===e?0:1/e,0===r?0:1/r,0===n?0:1/n),this.oneOverRadiiSquared=new Mt(0===e?0:1/(e*e),0===r?0:1/(r*r),0===n?0:1/(n*n)),this.minimumRadius=Math.min(e,r,n),this.maximumRadius=Math.max(e,r,n),this.centerToleranceSquared=At,0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}return b(t,null,[{key:"WGS84",get:function(){return Zt=Zt||new t(6378137,6378137,6356752.314245179)}}]),b(t,[{key:"equals",value:function(t){return this===t||Boolean(t&&this.radii.equals(t.radii))}},{key:"toString",value:function(){return this.radii.toString()}},{key:"cartographicToCartesian",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=Ht,n=$t,i=d(t,3),o=i[2];this.geodeticSurfaceNormalCartographic(t,r),n.copy(this.radiiSquared).scale(r);var a=Math.sqrt(r.dot(n));return n.scale(1/a),r.scale(o),n.add(r),n.to(e)}},{key:"cartesianToCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];ee.from(t);var r=this.scaleToGeodeticSurface(ee,Jt);if(r){var n=this.geodeticSurfaceNormal(r,Ht),i=te;i.copy(ee).subtract(r);var o=Math.atan2(n.y,n.x),a=Math.asin(n.z),s=Math.sign(ct(i,ee))*st(i);return Lt([o,a,s],e)}}},{key:"eastNorthUpToFixedFrame",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new _t;return Kt(this,"east","north","up",t,e)}},{key:"localFrameToFixedFrame",value:function(t,e,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new _t;return Kt(this,t,e,r,n,i)}},{key:"geocentricSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Xt.from(t).normalize().to(e)}},{key:"geodeticSurfaceNormalCartographic",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],r=Nt(t),n=r[0],i=r[1],o=Math.cos(i);return Xt.set(o*Math.cos(n),o*Math.sin(n),Math.sin(i)).normalize(),Xt.to(e)}},{key:"geodeticSurfaceNormal",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Xt.from(t).scale(this.oneOverRadiiSquared).normalize().to(e)}},{key:"scaleToGeodeticSurface",value:function(t,e){return function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Mt,n=e.oneOverRadii,i=e.oneOverRadiiSquared,o=e.centerToleranceSquared;qt.from(t);var a=t.x,s=t.y,u=t.z,c=n.x,h=n.y,l=n.z,f=a*a*c*c,y=s*s*h*h,p=u*u*l*l,v=f+y+p,d=Math.sqrt(1/v);if(Number.isFinite(d)){var m=Vt;if(m.copy(t).scale(d),v<o)return m.to(r);var g=i.x,b=i.y,k=i.z,w=zt;w.set(m.x*g*2,m.y*b*2,m.z*k*2);var _,x,S,T,O=(1-d)*t.len()/(.5*w.len()),E=0;do{var M=(_=1/(1+(O-=E)*g))*_,A=(x=1/(1+O*b))*x,P=(S=1/(1+O*k))*S,R=M*_,j=A*x,C=P*S,D=f*R*g+y*j*b+p*C*k,N=-2*D;E=(T=f*M+y*A+p*P-1)/N}while(Math.abs(T)>Pt);return qt.scale([_,x,S]).to(r)}}(t,this,e)}},{key:"scaleToGeocentricSurface",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];Jt.from(t);var r=Jt.x,n=Jt.y,i=Jt.z,o=this.oneOverRadiiSquared,a=1/Math.sqrt(r*r*o.x+n*n*o.y+i*i*o.z);return Jt.multiplyScalar(a).to(e)}},{key:"transformPositionToScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Jt.from(t).scale(this.oneOverRadii).to(e)}},{key:"transformPositionFromScaledSpace",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];return Jt.from(t).scale(this.radii).to(e)}},{key:"getSurfaceNormalIntersectionWithZAxis",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0];M(V(this.radii.x,this.radii.y,Rt)),M(this.radii.z>0),Jt.from(t);var n=Jt.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(n)>=this.radii.z-e))return Jt.set(0,0,n).to(r)}}]),t}(),ne=r(14),ie=function(){function t(e,r){m(this,t),this.name=e,this.type=r,this.sampleSize=1,this.reset()}return b(t,[{key:"setSampleSize",value:function(t){return this.sampleSize=t,this}},{key:"incrementCount",value:function(){return this.addCount(1),this}},{key:"decrementCount",value:function(){return this.subtractCount(1),this}},{key:"addCount",value:function(t){return this._count+=t,this._samples++,this._checkSampling(),this}},{key:"subtractCount",value:function(t){return this._count-=t,this._samples++,this._checkSampling(),this}},{key:"addTime",value:function(t){return this._time+=t,this.lastTiming=t,this._samples++,this._checkSampling(),this}},{key:"timeStart",value:function(){return this._startTime=Object(ne.a)(),this._timerPending=!0,this}},{key:"timeEnd",value:function(){return this._timerPending?(this.addTime(Object(ne.a)()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}},{key:"getSampleAverageCount",value:function(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}},{key:"getSampleAverageTime",value:function(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}},{key:"getSampleHz",value:function(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}},{key:"getAverageCount",value:function(){return this.samples>0?this.count/this.samples:0}},{key:"getAverageTime",value:function(){return this.samples>0?this.time/this.samples:0}},{key:"getHz",value:function(){return this.time>0?this.samples/(this.time/1e3):0}},{key:"reset",value:function(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}},{key:"_checkSampling",value:function(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}]),t}(),oe=function(){function t(e){var r=e.id,n=e.stats;m(this,t),this.id=r,this.stats={},this._initializeStats(n),Object.seal(this)}return b(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"count";return this._getOrCreate({name:t,type:e})}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach((function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}})),t}},{key:"_initializeStats",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach((function(e){return t._getOrCreate(e)}))}},{key:"_getOrCreate",value:function(t){if(!t||!t.name)return null;var e=t.name,r=t.type;return this.stats[e]||(this.stats[e]=t instanceof ie?t:new ie(e,r)),this.stats[e]}},{key:"size",get:function(){return Object.keys(this.stats).length}}]),t}();function ae(t,e){if(!t)throw new Error(e||"loader assertion failed.")}function se(t){var e=t&&t.lastIndexOf("/");return e>=0?t.substr(0,e):""}function ue(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ce(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ue(Object(r),!0).forEach((function(e){c()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ue(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var he={id:"request-scheduler",throttleRequests:!0,maxRequests:6},le=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l()(this,t),this.props=ce(ce({},he),e),this.requestQueue=[],this.activeRequestCount=0,this.requestMap=new Map,this.stats=new oe({id:e.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever"),this._deferredUpdate=null}return y()(t,[{key:"scheduleRequest",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return 0};if(!this.props.throttleRequests)return Promise.resolve({done:function(){}});if(this.requestMap.has(t))return this.requestMap.get(t);var r={handle:t,getPriority:e},n=new Promise((function(t){return r.resolve=t,r}));return this.requestQueue.push(r),this.requestMap.set(t,n),this._issueNewRequests(),n}},{key:"_issueRequest",value:function(t){var e=this,r=t.handle,n=t.resolve,i=!1,o=function(){i||(i=!0,e.requestMap.delete(r),e.activeRequestCount--,e._issueNewRequests())};return this.activeRequestCount++,n?n({done:o}):Promise.resolve({done:o})}},{key:"_issueNewRequests",value:function(){var t=this;this._deferredUpdate||(this._deferredUpdate=setTimeout((function(){return t._issueNewRequestsAsync()}),0))}},{key:"_issueNewRequestsAsync",value:function(){this._deferredUpdate=null;var t=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==t){this._updateAllRequests();for(var e=0;e<t;++e)if(this.requestQueue.length>0){var r=this.requestQueue.shift();this._issueRequest(r)}}}},{key:"_updateAllRequests",value:function(){for(var t=this.requestQueue,e=0;e<t.length;++e){var r=t[e];this._updateRequest(r)||(t.splice(e,1),this.requestMap.delete(r.handle),e--)}t.sort((function(t,e){return t.priority-e.priority}))}},{key:"_updateRequest",value:function(t){return t.priority=t.getPriority(t.handle),!(t.priority<0)||(t.resolve(null),!1)}}]),t}(),fe=function t(e,r,n){l()(this,t),this.item=e,this.previous=r,this.next=n},ye=function(){function t(){l()(this,t),this.head=null,this.tail=null,this._length=0}return y()(t,[{key:"add",value:function(t){var e=new fe(t,this.tail,null);return this.tail?(this.tail.next=e,this.tail=e):(this.head=e,this.tail=e),++this._length,e}},{key:"remove",value:function(t){t&&(t.previous&&t.next?(t.previous.next=t.next,t.next.previous=t.previous):t.previous?(t.previous.next=null,this.tail=t.previous):t.next?(t.next.previous=null,this.head=t.next):(this.head=null,this.tail=null),t.next=null,t.previous=null,--this._length)}},{key:"splice",value:function(t,e){t!==e&&(this.remove(e),this._insert(t,e))}},{key:"_insert",value:function(t,e){var r=t.next;t.next=e,this.tail===t?this.tail=e:r.previous=e,e.next=r,e.previous=t,++this._length}},{key:"length",get:function(){return this._length}}]),t}();function pe(t){return null!=t}var ve=function(){function t(){l()(this,t),this._list=new ye,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}return y()(t,[{key:"reset",value:function(){this._list.splice(this._list.tail,this._sentinel)}},{key:"touch",value:function(t){var e=t._cacheNode;pe(e)&&this._list.splice(this._sentinel,e)}},{key:"add",value:function(t,e,r){pe(e._cacheNode)||(e._cacheNode=this._list.add(e),r&&r(t,e))}},{key:"unloadTile",value:function(t,e,r){var n=e._cacheNode;pe(n)&&(this._list.remove(n),e._cacheNode=void 0,r&&r(t,e))}},{key:"unloadTiles",value:function(t,e){var r=this._trimTiles;this._trimTiles=!1;for(var n=this._list,i=1024*t.maximumMemoryUsage*1024,o=this._sentinel,a=n.head;a!==o&&(t.gpuMemoryUsageInBytes>i||r);){var s=a.item;a=a.next,this.unloadTile(t,s,e)}}},{key:"trim",value:function(){this._trimTiles=!0}}]),t}();function de(t,e){ae(t),ae(e);var r=e.rtcCenter,n=e.gltfUpAxis,i=t.computedTransform,o=t.boundingVolume.center,a=new _t(i);switch(r&&a.translate(r),n){case"Z":break;case"Y":var s=(new _t).rotateX(Math.PI/2);a=a.multiplyRight(s);break;case"X":var u=(new _t).rotateY(-Math.PI/2);a=a.multiplyRight(u)}e.isQuantized&&a.translate(e.quantizedVolumeOffset).scale(e.quantizedVolumeScale);var c=new Mt(o);e.cartesianModelMatrix=a,e.cartesianOrigin=c;var h=re.WGS84.cartesianToCartographic(c,new Mt),l=re.WGS84.eastNorthUpToFixedFrame(c).invert();e.cartographicModelMatrix=l.multiplyRight(a),e.cartographicOrigin=h,e.modelMatrix=e.cartographicModelMatrix}var me=Object.freeze({OUTSIDE:-1,INTERSECTING:0,INSIDE:1}),ge=new Mt,be=new Mt,ke=(function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;m(this,t),n=n||ge.copy(e).add(r).scale(.5),this.center=new Mt(n),this.halfDiagonal=new Mt(r).subtract(this.center),this.minimum=new Mt(e),this.maximum=new Mt(r)}b(t,[{key:"clone",value:function(){return new t(this.minimum,this.maximum,this.center)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.minimum.equals(t.minimum)&&this.maximum.equals(t.maximum)}},{key:"intersectPlane",value:function(t){var e=this.halfDiagonal,r=be.from(t.normal),n=e.x*Math.abs(r.x)+e.y*Math.abs(r.y)+e.z*Math.abs(r.z),i=this.center.dot(r)+t.distance;return i-n>0?me.INSIDE:i+n<0?me.OUTSIDE:me.INTERSECTING}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}},{key:"distanceSquaredTo",value:function(t){var e,r=ge.from(t).subtract(this.center),n=this.halfDiagonal,i=0;return(e=Math.abs(r.x)-n.x)>0&&(i+=e*e),(e=Math.abs(r.y)-n.y)>0&&(i+=e*e),(e=Math.abs(r.z)-n.z)>0&&(i+=e*e),i}}])}(),new Mt),we=new Mt,_e=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;m(this,t),this.radius=-0,this.center=new Mt,this.fromCenterRadius(e,r)}return b(t,[{key:"fromCenterRadius",value:function(t,e){return this.center.from(t),this.radius=e,this}},{key:"fromCornerPoints",value:function(t,e){return e=ke.from(e),this.center=(new Mt).from(t).add(e).scale(.5),this.radius=this.center.distance(e),this}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.radius===t.radius}},{key:"clone",value:function(){return new t(this.center,this.radius)}},{key:"union",value:function(t){var e=this.center,r=this.radius,n=t.center,i=t.radius,o=ke.copy(n).subtract(e),a=o.magnitude();if(r>=a+i)return this.clone();if(i>=a+r)return t.clone();var s=.5*(r+a+i);return we.copy(o).scale((-r+s)/a).add(e),this.center.copy(we),this.radius=s,this}},{key:"expand",value:function(t){var e=(t=ke.from(t)).subtract(this.center).magnitude();return e>this.radius&&(this.radius=e),this}},{key:"intersectPlane",value:function(t){var e=this.center,r=this.radius,n=t.normal.dot(e)+t.distance;return n<-r?me.OUTSIDE:n<r?me.INTERSECTING:me.INSIDE}},{key:"transform",value:function(t){this.center.transform(t);var e=et(ke,t);return this.radius=Math.max(e[0],Math.max(e[1],e[2]))*this.radius,this}},{key:"distanceSquaredTo",value:function(t){return(t=ke.from(t)).subtract(this.center).lengthSquared()-this.radius*this.radius}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}}]),t}();function xe(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=r[0],y=r[1],p=r[2],v=r[3],d=r[4],m=r[5],g=r[6],b=r[7],k=r[8];return t[0]=f*n+y*a+p*c,t[1]=f*i+y*s+p*h,t[2]=f*o+y*u+p*l,t[3]=v*n+d*a+m*c,t[4]=v*i+d*s+m*h,t[5]=v*o+d*u+m*l,t[6]=g*n+b*a+k*c,t[7]=g*i+b*s+k*h,t[8]=g*o+b*u+k*l,t}function Se(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Te(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=S(t);if(e){var i=S(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x(this,r)}}var Oe=Object.freeze([1,0,0,0,1,0,0,0,1]),Ee=Object.freeze([0,0,0,0,0,0,0,0,0]),Me=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL1ROW0:3,COL1ROW1:4,COL1ROW2:5,COL2ROW0:6,COL2ROW1:7,COL2ROW2:8}),Ae={},Pe=function(t){w(r,t);var e=Te(r);function r(t){var n;return m(this,r),n=e.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(t)?n.copy(t):n.identity(),n}return b(r,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return Me}}],[{key:"IDENTITY",get:function(){return Ae.IDENTITY=Ae.IDENTITY||Object.freeze(new r(Oe)),Ae.IDENTITY}},{key:"ZERO",get:function(){return Ae.ZERO=Ae.ZERO||Object.freeze(new r(Ee)),Ae.ZERO}}]),b(r,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this[4]=t[4],this[5]=t[5],this[6]=t[6],this[7]=t[7],this[8]=t[8],this.check()}},{key:"set",value:function(t,e,r,n,i,o,a,s,u){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this[4]=i,this[5]=o,this[6]=a,this[7]=s,this[8]=u,this.check()}},{key:"setRowMajor",value:function(t,e,r,n,i,o,a,s,u){return this[0]=t,this[1]=n,this[2]=a,this[3]=e,this[4]=i,this[5]=s,this[6]=r,this[7]=o,this[8]=u,this.check()}},{key:"determinant",value:function(){return e=(t=this)[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],e*(c*o-a*u)+r*(-c*i+a*s)+n*(u*i-o*s);var t,e,r,n,i,o,a,s,u,c}},{key:"identity",value:function(){return this.copy(Oe)}},{key:"fromQuaternion",value:function(t){return function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r+r,s=n+n,u=i+i,c=r*a,h=n*a,l=n*s,f=i*a,y=i*s,p=i*u,v=o*a,d=o*s,m=o*u;t[0]=1-l-p,t[3]=h-m,t[6]=f+d,t[1]=h+m,t[4]=1-c-p,t[7]=y-v,t[2]=f-d,t[5]=y+v,t[8]=1-c-l}(this,t),this.check()}},{key:"transpose",value:function(){return function(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],h=e[8],l=h*a-s*c,f=-h*o+s*u,y=c*o-a*u,p=r*l+n*f+i*y;p&&(p=1/p,t[0]=l*p,t[1]=(-h*n+i*c)*p,t[2]=(s*n-i*a)*p,t[3]=f*p,t[4]=(h*r-i*u)*p,t[5]=(-s*r+i*o)*p,t[6]=y*p,t[7]=(-c*r+n*u)*p,t[8]=(a*r-n*o)*p)}(this,this),this.check()}},{key:"multiplyLeft",value:function(t){return xe(this,t,this),this.check()}},{key:"multiplyRight",value:function(t){return xe(this,this,t),this.check()}},{key:"rotate",value:function(t){return function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=Math.sin(r),y=Math.cos(r);t[0]=y*n+f*a,t[1]=y*i+f*s,t[2]=y*o+f*u,t[3]=y*a-f*n,t[4]=y*s-f*i,t[5]=y*u-f*o,t[6]=c,t[7]=h,t[8]=l}(this,this,t),this.check()}},{key:"scale",value:function(t){return Array.isArray(t)?Se(this,this,t):Se(this,this,[t,t,t]),this.check()}},{key:"translate",value:function(t){return function(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],h=e[7],l=e[8],f=r[0],y=r[1];t[0]=n,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=f*n+y*a+c,t[7]=f*i+y*s+h,t[8]=f*o+y*u+l}(this,this,t),this.check()}},{key:"transform",value:function(t,e){switch(t.length){case 2:e=function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}(e||[-0,-0],t,this);break;case 3:e=ft(e||[-0,-0,-0],t,this);break;case 4:e=function(t,e,r){var n=e[0],i=e[1],o=e[2];return t[0]=r[0]*n+r[3]*i+r[6]*o,t[1]=r[1]*n+r[4]*i+r[7]*o,t[2]=r[2]*n+r[5]*i+r[8]*o,t[3]=e[3],t}(e||[-0,-0,-0,-0],t,this);break;default:throw new Error("Illegal vector")}return F(e,t.length),e}},{key:"transformVector",value:function(t,e){return B("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector2",value:function(t,e){return B("Matrix3.transformVector"),this.transform(t,e)}},{key:"transformVector3",value:function(t,e){return B("Matrix3.transformVector"),this.transform(t,e)}}]),r}(Z);function Re(){var t=new $(4);return $!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function je(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function Ce(t,e,r){var n=e[0],i=e[1],o=e[2],a=e[3],s=r[0],u=r[1],c=r[2],h=r[3];return t[0]=n*h+a*s+i*c-o*u,t[1]=i*h+a*u+o*s-n*c,t[2]=o*h+a*c+n*u-i*s,t[3]=a*h-n*s-i*u-o*c,t}function De(t,e,r,n){var i,o,a,s,u,c=e[0],h=e[1],l=e[2],f=e[3],y=r[0],p=r[1],v=r[2],d=r[3];return(o=c*y+h*p+l*v+f*d)<0&&(o=-o,y=-y,p=-p,v=-v,d=-d),1-o>H?(i=Math.acos(o),a=Math.sin(i),s=Math.sin((1-n)*i)/a,u=Math.sin(n*i)/a):(s=1-n,u=n),t[0]=s*c+u*y,t[1]=s*h+u*p,t[2]=s*l+u*v,t[3]=s*f+u*d,t}function Ne(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var o=(i+1)%3,a=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*o+o]-e[3*a+a]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*o+a]-e[3*a+o])*r,t[o]=(e[3*o+i]+e[3*i+o])*r,t[a]=(e[3*a+i]+e[3*i+a])*r}return t}var Ie,Le,qe,Ve,ze,Ue,Fe=function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},We=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},Be=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Ge=function(t,e,r,n){var i=e[0],o=e[1],a=e[2],s=e[3];return t[0]=i+n*(r[0]-i),t[1]=o+n*(r[1]-o),t[2]=a+n*(r[2]-a),t[3]=s+n*(r[3]-s),t},Qe=pt,Ye=vt,Ke=function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),t[0]=r*a,t[1]=n*a,t[2]=i*a,t[3]=o*a,t},Ze=(Ie=at(),Le=ut(1,0,0),qe=ut(0,1,0),function(t,e,r){var n=ct(e,r);return n<-.999999?(ht(Ie,Le,e),yt(Ie)<1e-6&&ht(Ie,qe,e),function(t,e){var r=e[0],n=e[1],i=e[2],o=r*r+n*n+i*i;o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o}(Ie,Ie),je(t,Ie,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ht(Ie,e,r),t[0]=Ie[0],t[1]=Ie[1],t[2]=Ie[2],t[3]=1+n,Ke(t,t))});Ve=Re(),ze=Re(),Ue=function(){var t=new $(9);return $!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}();function Xe(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=S(t);if(e){var i=S(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return x(this,r)}}var He=[0,0,0,1],$e=function(t){w(r,t);var e=Xe(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return m(this,r),t=e.call(this,-0,-0,-0,-0),Array.isArray(n)&&1===arguments.length?t.copy(n):t.set(n,i,o,a),t}return b(r,[{key:"copy",value:function(t){return this[0]=t[0],this[1]=t[1],this[2]=t[2],this[3]=t[3],this.check()}},{key:"set",value:function(t,e,r,n){return this[0]=t,this[1]=e,this[2]=r,this[3]=n,this.check()}},{key:"fromMatrix3",value:function(t){return Ne(this,t),this.check()}},{key:"identity",value:function(){return function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}(this),this.check()}},{key:"fromAxisRotation",value:function(t,e){return je(this,t,e),this.check()}},{key:"setAxisAngle",value:function(t,e){return this.fromAxisRotation(t,e)}},{key:"len",value:function(){return Qe(this)}},{key:"lengthSquared",value:function(){return Ye(this)}},{key:"dot",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.dot only takes one argument");return Be(this,t)}},{key:"rotationTo",value:function(t,e){return Ze(this,t,e),this.check()}},{key:"add",value:function(t,e){if(void 0!==e)throw new Error("Quaternion.add only takes one argument");return Fe(this,this,t),this.check()}},{key:"calculateW",value:function(){return function(t,e){var r=e[0],n=e[1],i=e[2];t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i))}(this,this),this.check()}},{key:"conjugate",value:function(){return function(t,e){t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3]}(this,this),this.check()}},{key:"invert",value:function(){return function(t,e){var r=e[0],n=e[1],i=e[2],o=e[3],a=r*r+n*n+i*i+o*o,s=a?1/a:0;t[0]=-r*s,t[1]=-n*s,t[2]=-i*s,t[3]=o*s}(this,this),this.check()}},{key:"lerp",value:function(t,e,r){return Ge(this,t,e,r),this.check()}},{key:"multiplyRight",value:function(t,e){return M(!e),Ce(this,this,t),this.check()}},{key:"multiplyLeft",value:function(t,e){return M(!e),Ce(this,t,this),this.check()}},{key:"normalize",value:function(){var t=this.len(),e=t>0?1/t:0;return this[0]=this[0]*e,this[1]=this[1]*e,this[2]=this[2]*e,this[3]=this[3]*e,0===t&&(this[3]=1),this.check()}},{key:"rotateX",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);t[0]=n*u+a*s,t[1]=i*u+o*s,t[2]=o*u-i*s,t[3]=a*u-n*s}(this,this,t),this.check()}},{key:"rotateY",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);t[0]=n*u-o*s,t[1]=i*u+a*s,t[2]=o*u+n*s,t[3]=a*u-i*s}(this,this,t),this.check()}},{key:"rotateZ",value:function(t){return function(t,e,r){r*=.5;var n=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(r),u=Math.cos(r);t[0]=n*u+i*s,t[1]=i*u-n*s,t[2]=o*u+a*s,t[3]=a*u-o*s}(this,this,t),this.check()}},{key:"scale",value:function(t){return We(this,this,t),this.check()}},{key:"slerp",value:function(t,e,r){switch(arguments.length){case 1:var n=arguments[0],i=n.start;t=void 0===i?He:i,e=n.target,r=n.ratio;break;case 2:var o=Array.prototype.slice.call(arguments);e=o[0],r=o[1],t=this}return De(this,t,e,r),this.check()}},{key:"transformVector4",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return dt(e,t,this),F(e,4)}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"setFromAxisAngle",value:function(t,e){return this.setAxisAngle(t,e)}},{key:"premultiply",value:function(t,e){return this.multiplyLeft(t,e)}},{key:"multiply",value:function(t,e){return this.multiplyRight(t,e)}},{key:"ELEMENTS",get:function(){return 4}},{key:"x",get:function(){return this[0]},set:function(t){this[0]=U(t)}},{key:"y",get:function(){return this[1]},set:function(t){this[1]=U(t)}},{key:"z",get:function(){return this[2]},set:function(t){this[2]=U(t)}},{key:"w",get:function(){return this[3]},set:function(t){this[3]=U(t)}}]),r}(Y),Je=new Mt,tr=new Mt,er=new Mt,rr=new Mt,nr=new Mt,ir=new Mt,or=new Mt,ar=new Mt,sr=new Mt,ur=new Mt,cr=0,hr=1,lr=2,fr=3,yr=4,pr=5,vr=6,dr=7,mr=8,gr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,0,0,0,0,0,0];m(this,t),this.center=(new Mt).from(e),this.halfAxes=new Pe(r)}return b(t,[{key:"fromCenterHalfSizeQuaternion",value:function(t,e,r){var n=new $e(r),i=(new Pe).fromQuaternion(n);return i[0]=i[0]*e[0],i[1]=i[1]*e[0],i[2]=i[2]*e[0],i[3]=i[3]*e[1],i[4]=i[4]*e[1],i[5]=i[5]*e[1],i[6]=i[6]*e[2],i[7]=i[7]*e[2],i[8]=i[8]*e[2],this.center=(new Mt).from(t),this.halfAxes=i,this}},{key:"clone",value:function(){return new t(this.center,this.halfAxes)}},{key:"equals",value:function(t){return this===t||Boolean(t)&&this.center.equals(t.center)&&this.halfAxes.equals(t.halfAxes)}},{key:"getBoundingSphere",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _e,e=this.halfAxes,r=e.getColumn(0,ar),n=e.getColumn(1,sr),i=e.getColumn(2,ur),o=Je.copy(r).add(n).add(i);return t.center.copy(this.center),t.radius=o.magnitude(),t}},{key:"intersectPlane",value:function(t){var e=this.center,r=t.normal,n=this.halfAxes,i=r.x,o=r.y,a=r.z,s=Math.abs(i*n[cr]+o*n[hr]+a*n[lr])+Math.abs(i*n[fr]+o*n[yr]+a*n[pr])+Math.abs(i*n[vr]+o*n[dr]+a*n[mr]),u=r.dot(e)+t.distance;return u<=-s?me.OUTSIDE:u>=s?me.INSIDE:me.INTERSECTING}},{key:"distanceTo",value:function(t){return Math.sqrt(this.distanceSquaredTo(t))}},{key:"distanceSquaredTo",value:function(t){var e=tr.from(t).subtract(this.center),r=this.halfAxes,n=r.getColumn(0,er),i=r.getColumn(1,rr),o=r.getColumn(2,nr),a=n.magnitude(),s=i.magnitude(),u=o.magnitude();n.normalize(),i.normalize(),o.normalize();var c,h=0;return(c=Math.abs(e.dot(n))-a)>0&&(h+=c*c),(c=Math.abs(e.dot(i))-s)>0&&(h+=c*c),(c=Math.abs(e.dot(o))-u)>0&&(h+=c*c),h}},{key:"computePlaneDistances",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[-0,-0],n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=this.center,a=this.halfAxes,s=a.getColumn(0,er),u=a.getColumn(1,rr),c=a.getColumn(2,nr),h=ir.copy(s).add(u).add(c).add(o),l=or.copy(h).subtract(t),f=e.dot(l);return n=Math.min(f,n),i=Math.max(f,i),h.copy(o).add(s).add(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),h.copy(o).add(s).subtract(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),h.copy(o).add(s).subtract(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),o.copy(h).subtract(s).add(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),o.copy(h).subtract(s).add(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),o.copy(h).subtract(s).subtract(u).add(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),o.copy(h).subtract(s).subtract(u).subtract(c),l.copy(h).subtract(t),f=e.dot(l),n=Math.min(f,n),i=Math.max(f,i),r[0]=n,r[1]=i,r}},{key:"getTransform",value:function(){}},{key:"halfSize",get:function(){var t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Mt(t).len(),new Mt(e).len(),new Mt(r).len()]}},{key:"quaternion",get:function(){var t=this.halfAxes.getColumn(0),e=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),n=new Mt(t).normalize(),i=new Mt(e).normalize(),o=new Mt(r).normalize();return(new $e).fromMatrix3(new Pe([].concat(E(n),E(i),E(o))))}}]),t}(),br=new Mt,kr=new Mt,wr=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,1],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;m(this,t),this.normal=new Mt,this.distance=-0,this.fromNormalDistance(e,r)}return b(t,[{key:"fromNormalDistance",value:function(t,e){return M(Number.isFinite(e)),this.normal.from(t).normalize(),this.distance=e,this}},{key:"fromPointNormal",value:function(t,e){t=br.from(t),this.normal.from(e).normalize();var r=-this.normal.dot(t);return this.distance=r,this}},{key:"fromCoefficients",value:function(t,e,r,n){return this.normal.set(t,e,r),M(V(this.normal.len(),1)),this.distance=n,this}},{key:"clone",value:function(e){return new t(this.normal,this.distance)}},{key:"equals",value:function(t){return V(this.distance,t.distance)&&V(this.normal,t.normal)}},{key:"getPointDistance",value:function(t){return this.normal.dot(t)+this.distance}},{key:"transform",value:function(t){var e=kr.copy(this.normal).transformAsVector(t).normalize(),r=this.normal.scale(-this.distance).transform(t);return this.fromPointNormal(r,e)}},{key:"projectPointOntoPlane",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0];t=br.from(t);var r=this.getPointDistance(t),n=kr.copy(this.normal).scale(r);return t.subtract(n).to(e)}}]),t}();function _r(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return xr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xr(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function xr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Sr=[new Mt([1,0,0]),new Mt([0,1,0]),new Mt([0,0,1])],Tr=new Mt,Or=new Mt,Er=(new wr(new Mt(1,0,0),0),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];m(this,t),this.planes=e,M(this.planes.every((function(t){return t instanceof wr})))}return b(t,null,[{key:"MASK_OUTSIDE",get:function(){return 4294967295}},{key:"MASK_INSIDE",get:function(){return 0}},{key:"MASK_INDETERMINATE",get:function(){return 2147483647}}]),b(t,[{key:"fromBoundingSphere",value:function(t){this.planes.length=2*Sr.length;var e,r=t.center,n=t.radius,i=0,o=_r(Sr);try{for(o.s();!(e=o.n()).done;){var a=e.value,s=this.planes[i],u=this.planes[i+1];s||(s=this.planes[i]=new wr),u||(u=this.planes[i+1]=new wr);var c=Tr.copy(a).scale(-n).add(r);a.dot(c);s.fromPointNormal(c,a);var h=Tr.copy(a).scale(n).add(r),l=Or.copy(a).negate();l.dot(h);u.fromPointNormal(h,l),i+=2}}catch(t){o.e(t)}finally{o.f()}return this}},{key:"computeVisibility",value:function(t){M(t);var e,r=me.INSIDE,n=_r(this.planes);try{for(n.s();!(e=n.n()).done;){var i=e.value;switch(t.intersectPlane(i)){case me.OUTSIDE:return me.OUTSIDE;case me.INTERSECTING:r=me.INTERSECTING}}}catch(t){n.e(t)}finally{n.f()}return r}},{key:"computeVisibilityWithPlaneMask",value:function(e,r){if(M(e,"boundingVolume is required."),M(Number.isFinite(r),"parentPlaneMask is required."),r===t.MASK_OUTSIDE||r===t.MASK_INSIDE)return r;for(var n=t.MASK_INSIDE,i=this.planes,o=0;o<this.planes.length;++o){var a=o<31?1<<o:0;if(!(o<31&&0==(r&a))){var s=i[o],u=e.intersectPlane(s);if(u===me.OUTSIDE)return t.MASK_OUTSIDE;u===me.INTERSECTING&&(n|=a)}}return n}}]),t}());function Mr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ar(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Pr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ar(Object(r),!0).forEach((function(e){Mr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ar(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Rr=new Mt,jr=new Mt,Cr=new Mt,Dr=new Mt,Nr=new Mt,Ir=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m(this,t),e=Pr({near:1,far:5e8},e),this.left=e.left,this._left=void 0,this.right=e.right,this._right=void 0,this.top=e.top,this._top=void 0,this.bottom=e.bottom,this._bottom=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this._cullingVolume=new Er([new wr,new wr,new wr,new wr,new wr,new wr]),this._perspectiveMatrix=new _t,this._infinitePerspective=new _t}return b(t,[{key:"clone",value:function(){return new t({right:this.right,left:this.left,top:this.top,bottom:this.bottom,near:this.near,far:this.far})}},{key:"equals",value:function(e){return e&&e instanceof t&&this.right===e.right&&this.left===e.left&&this.top===e.top&&this.bottom===e.bottom&&this.near===e.near&&this.far===e.far}},{key:"computeCullingVolume",value:function(t,e,r){M(t,"position is required."),M(e,"direction is required."),M(r,"up is required.");var n=this._cullingVolume.planes;r=Rr.copy(r).normalize();var i=jr.copy(e).cross(r).normalize(),o=Cr.copy(e).multiplyByScalar(this.near).add(t),a=Dr.copy(e).multiplyByScalar(this.far).add(t),s=Nr;return s.copy(i).multiplyByScalar(this.left).add(o).subtract(t).cross(r),n[0].fromPointNormal(t,s),s.copy(i).multiplyByScalar(this.right).add(o).subtract(t).cross(r).negate(),n[1].fromPointNormal(t,s),s.copy(r).multiplyByScalar(this.bottom).add(o).subtract(t).cross(i).negate(),n[2].fromPointNormal(t,s),s.copy(r).multiplyByScalar(this.top).add(o).subtract(t).cross(i),n[3].fromPointNormal(t,s),s=(new Mt).copy(e),n[4].fromPointNormal(o,s),s.negate(),n[5].fromPointNormal(a,s),this._cullingVolume}},{key:"getPixelDimensions",value:function(t,e,r,n){Lr(this),M(Number.isFinite(t)&&Number.isFinite(e)),M(t>0),M(e>0),M(r>0),M(n);var i=1/this.near,o=this.top*i,a=2*r*o/e,s=2*r*(o=this.right*i)/t;return n.x=s,n.y=a,n}},{key:"projectionMatrix",get:function(){return Lr(this),this._perspectiveMatrix}},{key:"infiniteProjectionMatrix",get:function(){return Lr(this),this._infinitePerspective}}]),t}();function Lr(t){M(Number.isFinite(t.right)&&Number.isFinite(t.left)&&Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t.top,r=t.bottom,n=t.right,i=t.left,o=t.near,a=t.far;e===t._top&&r===t._bottom&&i===t._left&&n===t._right&&o===t._near&&a===t._far||(M(t.near>0&&t.near<t.far,"near must be greater than zero and less than far."),t._left=i,t._right=n,t._top=e,t._bottom=r,t._near=o,t._far=a,t._perspectiveMatrix=(new _t).frustum({left:i,right:n,bottom:r,top:e,near:o,far:a}),t._infinitePerspective=(new _t).frustum({left:i,right:n,bottom:r,top:e,near:o,far:1/0}))}function qr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Vr(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?qr(Object(r),!0).forEach((function(e){Mr(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):qr(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}!function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};m(this,t),e=Vr({near:1,far:5e8,xOffset:0,yOffset:0},e),this._offCenterFrustum=new Ir,this.fov=e.fov,this._fov=void 0,this._fovy=void 0,this._sseDenominator=void 0,this.aspectRatio=e.aspectRatio,this._aspectRatio=void 0,this.near=e.near,this._near=this.near,this.far=e.far,this._far=this.far,this.xOffset=e.xOffset,this._xOffset=this.xOffset,this.yOffset=e.yOffset,this._yOffset=this.yOffset}b(t,[{key:"clone",value:function(){return new t({aspectRatio:this.aspectRatio,fov:this.fov,near:this.near,far:this.far})}},{key:"equals",value:function(e){return null!=e&&e instanceof t&&(zr(this),zr(e),this.fov===e.fov&&this.aspectRatio===e.aspectRatio&&this.near===e.near&&this.far===e.far&&this._offCenterFrustum.equals(e._offCenterFrustum))}},{key:"computeCullingVolume",value:function(t,e,r){return zr(this),this._offCenterFrustum.computeCullingVolume(t,e,r)}},{key:"getPixelDimensions",value:function(t,e,r,n){return zr(this),this._offCenterFrustum.getPixelDimensions(t,e,r,n)}},{key:"projectionMatrix",get:function(){return zr(this),this._offCenterFrustum.projectionMatrix}},{key:"infiniteProjectionMatrix",get:function(){return zr(this),this._offCenterFrustum.infiniteProjectionMatrix}},{key:"fovy",get:function(){return zr(this),this._fovy}},{key:"sseDenominator",get:function(){return zr(this),this._sseDenominator}}])}();function zr(t){M(Number.isFinite(t.fov)&&Number.isFinite(t.aspectRatio)&&Number.isFinite(t.near)&&Number.isFinite(t.far));var e=t._offCenterFrustum;t.fov===t._fov&&t.aspectRatio===t._aspectRatio&&t.near===t._near&&t.far===t._far&&t.xOffset===t._xOffset&&t.yOffset===t._yOffset||(M(t.fov>=0&&t.fov<Math.PI),M(t.aspectRatio>0),M(t.near>=0&&t.near<t.far),t._aspectRatio=t.aspectRatio,t._fov=t.fov,t._fovy=t.aspectRatio<=1?t.fov:2*Math.atan(Math.tan(.5*t.fov)/t.aspectRatio),t._near=t.near,t._far=t.far,t._sseDenominator=2*Math.tan(.5*t._fovy),t._xOffset=t.xOffset,t._yOffset=t.yOffset,e.top=t.near*Math.tan(.5*t._fovy),e.bottom=-e.top,e.right=t.aspectRatio*e.top,e.left=-e.right,e.near=t.near,e.far=t.far,e.right+=t.xOffset,e.left+=t.xOffset,e.top+=t.yOffset,e.bottom+=t.yOffset)}new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,new Mt,Math.PI;new Pe,new Pe,new Pe,new Pe,new Pe;new Mt,new Mt,new Mt,new Mt,new Mt,new Pe,new Pe,new Pe;var Ur=new Mt,Fr=new Mt,Wr=new Er([new wr,new wr,new wr,new wr,new wr,new wr]);function Br(t,e){var r=t.cameraDirection,n=t.cameraUp,i=t.height,o=t.distanceScales.metersPerUnit,a=[t.longitude,t.latitude,0],s=re.WGS84.cartographicToCartesian(a,new Mt),u=re.WGS84.eastNorthUpToFixedFrame(s),c=t.unprojectPosition(t.cameraPosition),h=re.WGS84.cartographicToCartesian(c,new Mt),l=new Mt(u.transformAsVector(new Mt(r).scale(o))).normalize(),f=new Mt(u.transformAsVector(new Mt(n).scale(o))).normalize();return function(t,e){var r=t.getFrustumPlanes(),n=0;for(var i in r){var o=r[i],a=o.normal.dot(t.center);Fr.copy(o.normal).scale(o.distance-a).add(t.center);var s=t.unprojectPosition(Fr),u=re.WGS84.cartographicToCartesian(s,new Mt);Wr.planes[n++].fromPointNormal(u,Ur.copy(e).subtract(u))}}(t,s),{camera:{position:h,direction:l,up:f},viewport:t,height:i,cullingVolume:Wr,frameNumber:e,sseDenominator:1.15}}var Gr=new Mt;var Qr=r(6),Yr=r.n(Qr),Kr=function(t){return"boolean"==typeof t},Zr=function(t){return"function"==typeof t},Xr=function(t){return null!==t&&"object"===Yr()(t)},Hr=function(t){return Xr(t)&&t.constructor==={}.constructor},$r=function(t){return t&&"function"==typeof t[Symbol.iterator]},Jr=function(t){return t&&"function"==typeof t[Symbol.asyncIterator]},tn=function(t){return"undefined"!=typeof Response&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json},en=function(t){return"undefined"!=typeof Blob&&t instanceof Blob},rn=function(t){return function(t){return"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||Xr(t)&&Zr(t.tee)&&Zr(t.cancel)&&Zr(t.getReader)}(t)||function(t){return Xr(t)&&Zr(t.read)&&Zr(t.pipe)&&Kr(t.readable)}(t)};function nn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function on(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?nn(Object(r),!0).forEach((function(e){c()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):nn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function an(t){if(!t)return!1;Array.isArray(t)&&(t=t[0]);var e=t.parseTextSync||t.parseSync||t.parse||t.parseStream||t.parseInBatches,r=t.options&&t.options[t.id];return e=e||r&&r.workerUrl}function sn(t){var e;return ae(t,"null loader"),ae(an(t),"invalid loader"),Array.isArray(t)&&(e=t[1],t=on(on({},t=t[0]),{},{options:on(on({},t.options),e)})),t.extension&&(t.extensions=t.extensions||t.extension,delete t.extension),Array.isArray(t.extensions)||(t.extensions=[t.extensions]),ae(t.extensions&&t.extensions.length>0&&t.extensions[0]),(t.parseTextSync||t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}var un=r(8),cn="",hn={};function ln(t){for(var e in hn)if(t.startsWith(e)){var r=hn[e];t=t.replace(e,r)}return t.startsWith("http://")||t.startsWith("https://")||(t="".concat(cn).concat(t)),t}var fn=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,yn=/^([-\w.]+\/[-\w.+]+)/;function pn(t){if("string"!=typeof t)return"";var e=t.match(fn);return e?e[1]:""}var vn=/\?.*/;function dn(t){if(tn(t)){var e=function(t){if("string"!=typeof t)return"";var e=t.match(yn);return e?e[1]:t}(t.headers.get("content-type")),r=pn(t.url);return{url:gn(t.url||""),type:e||r||null}}return en(t)?{url:gn(t.name||""),type:t.type||""}:"string"==typeof t?{url:gn(t),type:pn(t)}:{url:"",type:""}}function mn(t){return tn(t)?t.headers["content-length"]||-1:en(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}function gn(t){return t.replace(vn,"")}function bn(t){return kn.apply(this,arguments)}function kn(){return(kn=s()(o.a.mark((function t(e){var r,n,i,a,s,u,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!tn(e)){t.next=2;break}return t.abrupt("return",e);case 2:return r={},(n=mn(e))>=0&&(r["content-length"]=String(n)),i=dn(e),a=i.url,(s=i.type)&&(r["content-type"]=s),t.next=9,Tn(e);case 9:return(u=t.sent)&&(r["x-first-bytes"]=u),"string"==typeof e&&(e=(new TextEncoder).encode(e)),c=new Response(e,{headers:r}),Object.defineProperty(c,"url",{value:a}),t.abrupt("return",c);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function wn(t){return _n.apply(this,arguments)}function _n(){return(_n=s()(o.a.mark((function t(e){var r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.ok){t.next=5;break}return t.next=3,xn(e);case 3:throw r=t.sent,new Error(r);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function xn(t){return Sn.apply(this,arguments)}function Sn(){return(Sn=s()(o.a.mark((function t(e){var r,n,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): "),t.prev=1,n=e.headers.get("Content-Type"),i=e.statusText,!n.includes("application/json")){t.next=11;break}return t.t0=i,t.t1=" ",t.next=9,e.text();case 9:t.t2=t.sent,i=t.t0+=t.t1.concat.call(t.t1,t.t2);case 11:r=(r+=i).length>60?"".concat(r.slice(60),"..."):r,t.next=17;break;case 15:t.prev=15,t.t3=t.catch(1);case 17:return t.abrupt("return",r);case 18:case"end":return t.stop()}}),t,null,[[1,15]])})))).apply(this,arguments)}function Tn(t){return On.apply(this,arguments)}function On(){return(On=s()(o.a.mark((function t(e){var r,n,i,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=5,"string"!=typeof e){t.next=3;break}return t.abrupt("return","data:,".concat(e.slice(0,r)));case 3:if(!(e instanceof Blob)){t.next=8;break}return n=e.slice(0,5),t.next=7,new Promise((function(t){var e=new FileReader;e.onload=function(e){return t(e.target&&e.target.result)},e.readAsDataURL(n)}));case 7:return t.abrupt("return",t.sent);case 8:if(!(e instanceof ArrayBuffer)){t.next=12;break}return i=e.slice(0,r),a=En(i),t.abrupt("return","data:base64,".concat(a));case 12:return t.abrupt("return",null);case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function En(t){for(var e="",r=new Uint8Array(t),n=0;n<r.byteLength;n++)e+=String.fromCharCode(r[n]);return btoa(e)}function Mn(t){return An.apply(this,arguments)}function An(){return(An=s()(o.a.mark((function t(e){var r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r="Failed to fetch resource ".concat(e.url," (").concat(e.status,"): "),t.prev=1,!e.headers.get("Content-Type").includes("application/json")){t.next=10;break}return t.t0=r,t.next=7,e.text();case 7:r=t.t0+=t.sent,t.next=11;break;case 10:r+=e.statusText;case 11:t.next=16;break;case 13:return t.prev=13,t.t1=t.catch(1),t.abrupt("return",r);case 16:return t.abrupt("return",r);case 17:case"end":return t.stop()}}),t,null,[[1,13]])})))).apply(this,arguments)}function Pn(t){return Rn.apply(this,arguments)}function Rn(){return(Rn=s()(o.a.mark((function t(e){var r,n,i=arguments;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=i.length>1&&void 0!==i[1]?i[1]:{},"string"==typeof e){t.next=5;break}return t.next=4,bn(e);case 4:return t.abrupt("return",t.sent);case 5:return e=ln(e),t.next=8,fetch(e,r);case 8:if((n=t.sent).ok||!r.throws){t.next=15;break}return t.t0=Error,t.next=13,Mn(n);case 13:throw t.t1=t.sent,new t.t0(t.t1);case 15:return t.abrupt("return",n);case 16:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var jn=function(){function t(){l()(this,t)}return y()(t,[{key:"log",value:function(){return function(t){}}},{key:"info",value:function(){return function(t){}}},{key:"warn",value:function(){return function(t){}}},{key:"error",value:function(){return function(t){}}}]),t}();function Cn(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return Dn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Dn(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function Dn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Nn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function In(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Nn(Object(r),!0).forEach((function(e){c()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Nn(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Ln={baseUri:"",fetch:null,CDN:"https://unpkg.com/@loaders.gl",worker:!0,log:new(function(){function t(){l()(this,t),this.console=console}return y()(t,[{key:"log",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=this.console.log).bind.apply(t,[this.console].concat(r))}},{key:"info",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=this.console.info).bind.apply(t,[this.console].concat(r))}},{key:"warn",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=this.console.warn).bind.apply(t,[this.console].concat(r))}},{key:"error",value:function(){for(var t,e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return(t=this.console.error).bind.apply(t,[this.console].concat(r))}}]),t}()),metadata:!1,transforms:[],reuseWorkers:!0},qn={dataType:"(no longer used)",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"},Vn=function(){un.a.loaders=un.a.loaders||{};var t=un.a.loaders;return t._state=t._state||{},t._state},zn=function(){var t=Vn();return t.globalOptions=t.globalOptions||In({},Ln),t.globalOptions};function Un(t,e,r,n){return r=r||[],function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console;Wn(t,null,r,Ln,qn,e);var n,i=Cn(e);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=t&&t[o.id]||{},s=o.options&&o.options[o.id]||{},u=o.defaultOptions&&o.defaultOptions[o.id]||{};Wn(a,o.id,r,s,u,e)}}catch(t){i.e(t)}finally{i.f()}}(t,r=Array.isArray(r)?r:[r]),Gn(e,t,n)}function Fn(t,e){var r=zn(),n=t.fetch||r.fetch;return"function"==typeof n?n:Xr(n)?function(t){return Pn(t,n)}:e&&e.fetch?e.fetch:function(e){return Pn(e,t)}}function Wn(t,e,r,n,i,o){var a=e||"Top level",s=e?"".concat(e,"."):"";for(var u in t){var c=!e&&Xr(t[u]);if(!(u in n))if(u in i)r.warn("".concat(a," loader option '").concat(s).concat(u,"' deprecated, use '").concat(i[u],"'"));else if(!c){var h=Bn(u,o);r.warn("".concat(a," loader option '").concat(s).concat(u,"' not recognized. ").concat(h))}}}function Bn(t,e){var r,n=t.toLowerCase(),i="",o=Cn(e);try{for(o.s();!(r=o.n()).done;){var a=r.value;for(var s in a.options){if(t===s)return"Did you mean '".concat(a.id,".").concat(s,"'?");var u=s.toLowerCase();(n.startsWith(u)||u.startsWith(n))&&(i=i||"Did you mean '".concat(a.id,".").concat(s,"'?"))}}}catch(t){o.e(t)}finally{o.f()}return i}function Gn(t,e,r){var n=In({},t.options||{});return null===n.log&&(n.log=new jn),Qn(n,zn()),Qn(n,e),function(t,e){e&&!t.baseUri&&(t.baseUri=e)}(n,r),n}function Qn(t,e){for(var r in e)if(r in e){var n=e[r];Hr(n)&&Hr(t[r])?t[r]=In(In({},t[r]),e[r]):t[r]=e[r]}}function Yn(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"2.3.9";ae(t,"no loader provided");var r=t.version;e&&r&&(e=Kn(e),r=Kn(r))}function Kn(t){var e=t.split(".").map(Number);return{major:e[0],minor:e[1]}}var Zn=r(16),Xn=r.n(Zn),Hn=r(21);function $n(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return Jn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Jn(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function Jn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ti(t){if(Hn.toArrayBuffer&&(t=Hn.toArrayBuffer(t)),t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.buffer;if("string"==typeof t){var e=t;return(new TextEncoder).encode(e).buffer}return t&&"object"===Yr()(t)&&t._toArrayBuffer?t._toArrayBuffer():ae(!1)}function ei(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];var n,i=e.map((function(t){return t instanceof ArrayBuffer?new Uint8Array(t):t})),o=i.reduce((function(t,e){return t+e.byteLength}),0),a=new Uint8Array(o),s=0,u=$n(i);try{for(u.s();!(n=u.n()).done;){var c=n.value;a.set(c,s),s+=c.byteLength}}catch(t){u.e(t)}finally{u.f()}return a.buffer}function ri(t){return ni.apply(this,arguments)}function ni(){return(ni=s()(o.a.mark((function t(e){var r,n,i,a,s,u,c,h,l;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=[],n=[],i=!0,a=!1,t.prev=4,u=Xn()(e);case 6:return t.next=8,u.next();case 8:return c=t.sent,i=c.done,t.next=12,c.value;case 12:if(h=t.sent,i){t.next=19;break}"string"==typeof(l=h)?n.push(l):r.push(l);case 16:i=!0,t.next=6;break;case 19:t.next=25;break;case 21:t.prev=21,t.t0=t.catch(4),a=!0,s=t.t0;case 25:if(t.prev=25,t.prev=26,i||null==u.return){t.next=30;break}return t.next=30,u.return();case 30:if(t.prev=30,!a){t.next=33;break}throw s;case 33:return t.finish(30);case 34:return t.finish(25);case 35:if(!(n.length>0)){t.next=38;break}return ae(0===r.length),t.abrupt("return",n.join(""));case 38:return t.abrupt("return",ei.apply(void 0,r));case 39:case"end":return t.stop()}}),t,null,[[4,21,25,35],[26,,30,34]])})))).apply(this,arguments)}var ii=o.a.mark(oi);function oi(t){var e,r,n,i,a,s,u,c=arguments;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:e=c.length>1&&void 0!==c[1]?c[1]:{},r=e.chunkSize,n=void 0===r?262144:r,i=0,a=new TextEncoder;case 4:if(!(i<t.length)){o.next=12;break}return s=Math.min(t.length-i,n),u=t.slice(i,i+s),i+=s,o.next=10,a.encode(u);case 10:o.next=4;break;case 12:case"end":return o.stop()}}),ii)}var ai=o.a.mark(si);function si(t){var e,r,n,i,a,s,u,c=arguments;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:e=c.length>1&&void 0!==c[1]?c[1]:{},r=e.chunkSize,n=void 0===r?262144:r,i=0;case 3:if(!(i<t.byteLength)){o.next=14;break}return a=Math.min(t.byteLength-i,n),s=new ArrayBuffer(a),u=new Uint8Array(t,i,a),new Uint8Array(s).set(u),i+=a,o.next=12,s;case 12:o.next=3;break;case 14:case"end":return o.stop()}}),ai)}var ui=r(7),ci=r.n(ui),hi=r(11),li=r.n(hi);function fi(t){return yi.apply(this,arguments)}function yi(){return(yi=li()(o.a.mark((function t(e){var r,n,i,a,s,u=arguments;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=u.length>1&&void 0!==u[1]?u[1]:{},n=r.chunkSize||1048576,i=0;case 3:if(!(i<e.size)){t.next=13;break}return a=i+n,t.next=7,ci()(pi(e,i,a));case 7:return s=t.sent,i=a,t.next=11,s;case 11:t.next=3;break;case 13:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function pi(t,e,r){return vi.apply(this,arguments)}function vi(){return(vi=s()(o.a.mark((function t(e,r,n){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t,i){var o=e.slice(r,n),a=new FileReader;a.onload=function(e){return t(e.target&&e.target.result)},a.onerror=function(t){return i(t)},a.readAsArrayBuffer(o)}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function di(t){if(un.b||un.c>=10){if("function"==typeof t[Symbol.asyncIterator])return function(t){return mi.apply(this,arguments)}(t);if("function"==typeof t.getIterator)return t.getIterator()}return un.b?function(t){return gi.apply(this,arguments)}(t):function(t){return bi.apply(this,arguments)}(t)}function mi(){return(mi=li()(o.a.mark((function t(e){var r,n,i,a,s,u,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=!0,n=!1,t.prev=2,a=Xn()(e);case 4:return t.next=6,ci()(a.next());case 6:return s=t.sent,r=s.done,t.next=10,ci()(s.value);case 10:if(u=t.sent,r){t.next=18;break}return c=u,t.next=15,ti(c);case 15:r=!0,t.next=4;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(2),n=!0,i=t.t0;case 24:if(t.prev=24,t.prev=25,r||null==a.return){t.next=29;break}return t.next=29,ci()(a.return());case 29:if(t.prev=29,!n){t.next=32;break}throw i;case 32:return t.finish(29);case 33:return t.finish(24);case 34:case"end":return t.stop()}}),t,null,[[2,20,24,34],[25,,29,33]])})))).apply(this,arguments)}function gi(){return(gi=li()(o.a.mark((function t(e){var r,n,i,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.getReader(),t.prev=1;case 2:return t.next=5,ci()(r.read());case 5:if(n=t.sent,i=n.done,a=n.value,!i){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,ti(a);case 12:t.next=2;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(1),r.releaseLock();case 19:case"end":return t.stop()}}),t,null,[[1,16]])})))).apply(this,arguments)}function bi(){return(bi=li()(o.a.mark((function t(e){var r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ci()(e);case 2:e=t.sent;case 3:if(null===(r=e.read())){t.next=9;break}return t.next=8,ti(r);case 8:return t.abrupt("continue",3);case 9:if(!e._readableState.ended){t.next=11;break}return t.abrupt("return");case 11:return t.next=13,ci()(ki(e));case 13:t.next=3;break;case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function ki(t){return wi.apply(this,arguments)}function wi(){return(wi=s()(o.a.mark((function t(e){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.once("readable",t)})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof t?oi(t,e):t instanceof ArrayBuffer?si(t,e):en(t)?fi(t,e):rn(t)?di(t):tn(t)?di(t.body):ae(!1)}var xi="Cannot convert supplied data type";function Si(t,e){if(e.text&&"string"==typeof t)return t;if(t instanceof ArrayBuffer){var r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)||(o=t)&&"object"===Yr()(o)&&o.isBuffer){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);var n=t.buffer,i=t.byteLength||t.length;return 0===t.byteOffset&&i===n.byteLength||(n=n.slice(t.byteOffset,t.byteOffset+i)),n}var o;throw new Error(xi)}function Ti(t,e){return Oi.apply(this,arguments)}function Oi(){return(Oi=s()(o.a.mark((function t(e,r){var n,i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e instanceof ArrayBuffer||ArrayBuffer.isView(e),"string"!=typeof e&&!n){t.next=3;break}return t.abrupt("return",Si(e,r));case 3:if(!en(e)){t.next=7;break}return t.next=6,bn(e);case 6:e=t.sent;case 7:if(!tn(e)){t.next=21;break}return i=e,t.next=11,wn(i);case 11:if(!r.binary){t.next=17;break}return t.next=14,i.arrayBuffer();case 14:t.t0=t.sent,t.next=20;break;case 17:return t.next=19,i.text();case 19:t.t0=t.sent;case 20:return t.abrupt("return",t.t0);case 21:if(rn(e)&&(e=_i(e)),!$r(e)&&!Jr(e)){t.next=24;break}return t.abrupt("return",ri(e));case 24:throw new Error(xi);case 25:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Ei=r(10),Mi=r.n(Ei);function Ai(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Pi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ai(Object(r),!0).forEach((function(e){c()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ai(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function Ri(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return r||(t=Pi({fetch:Fn(e||{},t)},t),Array.isArray(t.loaders)||(t.loaders=null),t)}function ji(t,e){if(!e&&t&&!Array.isArray(t))return t;var r;if(t&&(r=Array.isArray(t)?t:[t]),e&&e.loaders){var n=Array.isArray(e.loaders)?e.loaders:[e.loaders];r=r?[].concat(Mi()(r),Mi()(n)):n}return r&&r.length?r:null}var Ci=new Map;function Di(t){return"try {\n  importScripts('".concat(t,"');\n} catch (error) {\n  console.error(error);\n}")}function Ni(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=r||new Set;if(t){if(Ii(t))n.add(t);else if(Ii(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"===Yr()(t))for(var i in t)Ni(t[i],e,n)}else;return void 0===r?Array.from(n):[]}function Ii(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var Li=0;function qi(t){var e=t.data;(0,t.resolve)(e)}var Vi=function(){function t(e){var r=e.source,n=e.name,i=void 0===n?"web-worker-".concat(Li++):n,o=e.onMessage;l()(this,t);var a=function(t){if(ae("string"==typeof t,"worker source"),t.startsWith("url(")&&t.endsWith(")")){var e=t.match(/^url\((.*)\)$/)[1];if(e&&!e.startsWith("http"))return e;t=Di(e)}var r=Ci.get(t);if(!r){var n=new Blob([t],{type:"application/javascript"});r=URL.createObjectURL(n),Ci.set(t,r)}return r}(r,i);this.worker=new Worker(a,{name:i}),this.name=i,this.onMessage=o||qi}var e;return y()(t,[{key:"process",value:(e=s()(o.a.mark((function t(e){var r=this;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){r.worker.onmessage=function(e){r.onMessage({worker:r.worker,data:e.data,resolve:t,reject:n})},r.worker.onerror=function(t){var e="".concat(r.name,": WorkerThread.process() failed");t.message&&(e+=" ".concat(t.message," ").concat(t.filename,":").concat(t.lineno,":").concat(t.colno));var i=new Error(e);console.error(t),n(i)};var i=Ni(e);r.worker.postMessage(e,i)})));case 1:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})},{key:"destroy",value:function(){this.worker.terminate(),this.worker=null}}]),t}(),zi=function(){function t(e){var r=e.source,n=e.name,i=void 0===n?"unnamed":n,o=e.maxConcurrency,a=void 0===o?1:o,s=e.onMessage,u=e.onDebug,c=void 0===u?function(){}:u,h=e.reuseWorkers,f=void 0===h||h;l()(this,t),this.source=r,this.name=i,this.maxConcurrency=a,this.onMessage=s,this.onDebug=c,this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.reuseWorkers=f}var e;return y()(t,[{key:"destroy",value:function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0}},{key:"process",value:function(t,e){var r=this;return new Promise((function(n,i){r.jobQueue.push({data:t,jobName:e,resolve:n,reject:i}),r._startQueuedJob()}))}},{key:"_startQueuedJob",value:(e=s()(o.a.mark((function t(){var e,r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.jobQueue.length){t.next=2;break}return t.abrupt("return");case 2:if(e=this._getAvailableWorker()){t.next=5;break}return t.abrupt("return");case 5:return r=this.jobQueue.shift(),this.onDebug({message:"processing",worker:e.name,job:r.jobName,backlog:this.jobQueue.length}),t.prev=7,t.t0=r,t.next=11,e.process(r.data);case 11:t.t1=t.sent,t.t0.resolve.call(t.t0,t.t1),t.next=18;break;case 15:t.prev=15,t.t2=t.catch(7),r.reject(t.t2);case 18:return t.prev=18,this._onWorkerDone(e),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[7,15,18,21]])}))),function(){return e.apply(this,arguments)})},{key:"_onWorkerDone",value:function(t){this.isDestroyed?t.destroy():(this.reuseWorkers?this.idleQueue.push(t):(t.destroy(),this.count--),this._startQueuedJob())}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift();if(this.count<this.maxConcurrency){this.count++;var t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Vi({source:this.source,onMessage:this.onMessage,name:t})}return null}}]),t}(),Ui=function(){function t(e){var r=e.maxConcurrency,n=void 0===r?5:r,i=e.onMessage,o=void 0===i?null:i,a=e.onDebug,s=void 0===a?function(){}:a,u=e.reuseWorkers,c=void 0===u||u;l()(this,t),this.maxConcurrency=n,this.onMessage=o,this.onDebug=s,this.workerPools=new Map,this.reuseWorkers=c}var e;return y()(t,null,[{key:"isSupported",value:function(){return"undefined"!=typeof Worker}}]),y()(t,[{key:"setProps",value:function(t){"maxConcurrency"in t&&(this.maxConcurrency=t.maxConcurrency),"onDebug"in t&&(this.onDebug=t.onDebug),"reuseWorkers"in t&&(this.reuseWorkers=t.reuseWorkers)}},{key:"destroy",value:function(){this.workerPools.forEach((function(t){return t.destroy()}))}},{key:"process",value:(e=s()(o.a.mark((function t(e,r,n){var i;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this._getWorkerPool(e,r),t.abrupt("return",i.process(n));case 2:case"end":return t.stop()}}),t,this)}))),function(t,r,n){return e.apply(this,arguments)})},{key:"_getWorkerPool",value:function(t,e){var r=this.workerPools.get(e);return r||(r=new zi({source:t,name:e,onMessage:Fi.bind(null,this.onMessage),maxConcurrency:this.maxConcurrency,onDebug:this.onDebug,reuseWorkers:this.reuseWorkers}),this.workerPools.set(e,r)),r}}]),t}();function Fi(t,e){var r=e.worker,n=e.data,i=e.resolve,o=e.reject;if(t)t({worker:r,data:n,resolve:i,reject:o});else switch(n.type){case"done":i(n.result);break;case"error":o(n.message)}}function Wi(t,e,r,n){if(!Ui.isSupported())return!1;var i=r&&r[t.id];return!!("local"===r.worker&&i&&i.localWorkerUrl||r.worker&&i&&i.workerUrl)&&(!t.useWorker||t.useWorker(r))}function Bi(t,e,r,n){var i=(r||{}).worker,o=r&&r[t.id]||{},a="local"===i?o.localWorkerUrl:o.workerUrl,s="url(".concat(a,")"),u=t.name,c=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};t.maxConcurrency&&(e.maxConcurrency=t.maxConcurrency);t.onDebug&&(e.onDebug=t.onDebug);"reuseWorkers"in t&&(e.reuseWorkers=t.reuseWorkers);Gi||(Gi=new Ui({onMessage:Qi}));return Gi.setProps(e),Gi}(r);r=JSON.parse(JSON.stringify(r));var h="2.3.9"!==t.version?"(core version ".concat("2.3.9",")"):"";return c.process(s,"".concat(u,"-worker@").concat(t.version).concat(h),{arraybuffer:ti(e),options:r,source:"loaders.gl@".concat("2.3.9"),type:"parse"})}var Gi=null;function Qi(t){return Yi.apply(this,arguments)}function Yi(){return(Yi=s()(o.a.mark((function t(e){var r,n,i,a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=e.worker,n=e.data,i=e.resolve,a=e.reject,t.t0=n.type,t.next="done"===t.t0?4:"parse"===t.t0?6:"error"===t.t0?17:19;break;case 4:return i(n.result),t.abrupt("break",19);case 6:return t.prev=6,t.next=9,fo(n.arraybuffer,n.options,n.url);case 9:s=t.sent,r.postMessage({type:"parse-done",id:n.id,result:s},Ni(s)),t.next=16;break;case 13:t.prev=13,t.t1=t.catch(6),r.postMessage({type:"parse-error",id:n.id,message:t.t1.message});case 16:return t.abrupt("break",19);case 17:return a(n.message),t.abrupt("break",19);case 19:case"end":return t.stop()}}),t,null,[[6,13]])})))).apply(this,arguments)}var Ki=function(){var t=Vn();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function Zi(){return Ki()}function Xi(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Hi(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Xi(Object(r),!0).forEach((function(e){c()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Xi(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function $i(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return Ji(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ji(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function Ji(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var to=/\.([^.]+)$/;function eo(t){return ro.apply(this,arguments)}function ro(){return(ro=s()(o.a.mark((function t(e){var r,n,i,a,s=arguments;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=s.length>1&&void 0!==s[1]?s[1]:[],n=s.length>2&&void 0!==s[2]?s[2]:{},i=s.length>3&&void 0!==s[3]?s[3]:{},!(a=no(e,r,Hi(Hi({},n),{},{nothrow:!0}),i))){t.next=6;break}return t.abrupt("return",a);case 6:if(!en(e)){t.next=11;break}return t.next=9,pi(e,0,10);case 9:e=t.sent,a=no(e,r,n,i);case 11:if(a||n.nothrow){t.next=13;break}throw new Error(io(e));case 13:return t.abrupt("return",a);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function no(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(e&&!Array.isArray(e))return sn(e);oo(e=[].concat(Mi()(e||[]),Mi()(Zi())));var i=dn(t),o=i.url,a=i.type,s=ao(e,o||n.url);if(!(s=(s=s||so(e,a))||uo(e,t))&&!r.nothrow)throw new Error(io(t));return s}function io(t){var e=dn(t),r=e.url,n=e.type,i="No valid loader found";return t&&(i+=' data: "'.concat(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"==typeof t)return t.slice(0,e);if(ArrayBuffer.isView(t))return lo(t.buffer,t.byteOffset,e);if(t instanceof ArrayBuffer){var r=0;return lo(t,r,e)}return""}(t),'", contentType: "').concat(n,'"')),r&&(i+=" url: ".concat(r)),i}function oo(t){var e,r=$i(t);try{for(r.s();!(e=r.n()).done;){sn(e.value)}}catch(t){r.e(t)}finally{r.f()}}function ao(t,e){var r=e&&e.match(to),n=r&&r[1];return n&&function(t,e){e=e.toLowerCase();var r,n=$i(t);try{for(n.s();!(r=n.n()).done;){var i,o=r.value,a=$i(o.extensions);try{for(a.s();!(i=a.n()).done;){if(i.value.toLowerCase()===e)return o}}catch(t){a.e(t)}finally{a.f()}}}catch(t){n.e(t)}finally{n.f()}return null}(t,n)}function so(t,e){var r,n=$i(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(i.mimeTypes&&i.mimeTypes.includes(e))return i;if(e==="application/x.".concat(i.id))return i}}catch(t){n.e(t)}finally{n.f()}return null}function uo(t,e){if(!e)return null;var r,n=$i(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;if("string"==typeof e){if(co(e,i))return i}else if(ArrayBuffer.isView(e)){if(ho(e.buffer,e.byteOffset,i))return i}else if(e instanceof ArrayBuffer){if(ho(e,0,i))return i}}}catch(t){n.e(t)}finally{n.f()}return null}function co(t,e){return e.testText&&e.testText(t)}function ho(t,e,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some((function(n){return function(t,e,r,n){if(n instanceof ArrayBuffer)return function(t,e,r){if(r=r||t.byteLength,t.byteLength<r||e.byteLength<r)return!1;for(var n=new Uint8Array(t),i=new Uint8Array(e),o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}(n,t,n.byteLength);switch(Yr()(n)){case"function":return n(t,r);case"string":var i=lo(t,e,n.length);return n===i;default:return!1}}(t,e,r,n)}))}function lo(t,e,r){if(t.byteLength<e+r)return"";for(var n=new DataView(t),i="",o=0;o<r;o++)i+=String.fromCharCode(n.getUint8(e+o));return i}function fo(t,e,r,n){return yo.apply(this,arguments)}function yo(){return(yo=s()(o.a.mark((function t(e,r,n,i){var a,s,u,c;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ae(!i||"string"!=typeof i,"parse no longer accepts final url"),!r||Array.isArray(r)||an(r)||(i=n,n=r,r=null),t.next=4,e;case 4:return e=t.sent,n=n||{},a=dn(e),s=a.url,u=ji(r,i),t.next=10,eo(e,u,n);case 10:if(c=t.sent){t.next=13;break}return t.abrupt("return",null);case 13:return n=Un(n,c,u,s),i=Ri({url:s,parse:fo,loaders:u},n,i),t.next=17,po(c,e,n,i);case 17:return t.abrupt("return",t.sent);case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function po(t,e,r,n){return vo.apply(this,arguments)}function vo(){return(vo=s()(o.a.mark((function t(e,r,n,i){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Yn(e),t.next=3,Ti(r,e);case 3:if(r=t.sent,!e.parseTextSync||"string"!=typeof r){t.next=7;break}return n.dataType="text",t.abrupt("return",e.parseTextSync(r,n,i,e));case 7:if(!Wi(e,0,n)){t.next=11;break}return t.next=10,Bi(e,r,n);case 10:return t.abrupt("return",t.sent);case 11:if(!e.parseText||"string"!=typeof r){t.next=15;break}return t.next=14,e.parseText(r,n,i,e);case 14:return t.abrupt("return",t.sent);case 15:if(!e.parse){t.next=19;break}return t.next=18,e.parse(r,n,i,e);case 18:return t.abrupt("return",t.sent);case 19:return ae(!e.parseSync),t.abrupt("return",ae(!1));case 21:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function mo(t,e,r){return go.apply(this,arguments)}function go(){return(go=s()(o.a.mark((function t(e,r,n){var i,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(r)||an(r)||(n=r,r=null),i=Fn(n||{}),a=e,"string"!=typeof e){t.next=9;break}return t.next=6,i(e);case 6:a=t.sent,t.next=10;break;case 9:e=null;case 10:if(!en(e)){t.next=15;break}return t.next=13,i(e);case 13:a=t.sent,e=null;case 15:return t.next=17,fo(a,r,n);case 17:return t.abrupt("return",t.sent);case 18:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var bo={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5},ko={ADD:1,REPLACE:2},wo={EMPTY:"empty",SCENEGRAPH:"scenegraph",POINTCLOUD:"pointcloud",MESH:"mesh"},_o={I3S:"I3S",TILES3D:"TILES3D"},xo={GEOMETRIC_ERROR:"geometricError",MAX_SCREEN_THRESHOLD:"maxScreenThreshold"},So=1,To=r(9),Oo=r.n(To);function Eo(t){return null!=t}var Mo=new Mt,Ao=new Mt,Po=new Mt;new _t;function Ro(t,e,r){if(ae(t,"3D Tile: boundingVolume must be defined"),t.box)return function(t,e,r){var n=new Mt(t[0],t[1],t[2]);e.transform(n,n);var i=e.transformAsVector(t.slice(3,6)),o=e.transformAsVector(t.slice(6,9)),a=e.transformAsVector(t.slice(9,12)),s=new Pe([i[0],i[1],i[2],o[0],o[1],o[2],a[0],a[1],a[2]]);if(Eo(r))return r.center=n,r.halfAxes=s,r;return new gr(n,s)}(t.box,e,r);if(t.region){var n=Oo()(t.region,6),i=n[0],o=n[1],a=n[2],s=n[3],u=n[4],c=n[5],h=re.WGS84.cartographicToCartesian([q(i),q(s),u],Ao),l=re.WGS84.cartographicToCartesian([q(a),q(o),c],Po),f=(new Mt).addVectors(h,l).multiplyScalar(.5),y=(new Mt).subVectors(h,l).len()/2;return jo([f[0],f[1],f[2],y],new _t)}if(t.sphere)return jo(t.sphere,e,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function jo(t,e,r){var n=new Mt(t[0],t[1],t[2]);e.transform(n,n);var i=e.getScale(Mo),o=Math.max(Math.max(i[0],i[1]),i[2]),a=t[3]*o;return Eo(r)?(r.center=n,r.radius=a,r):new _e(n,a)}new Mt,new Mt,new _t,new Mt,new Mt,new Mt;function Co(t,e){if(t.dynamicScreenSpaceError&&t._dynamicScreenSpaceErrorComputedDensity){var r=t._dynamicScreenSpaceErrorComputedDensity,n=t.dynamicScreenSpaceErrorFactor;return function(t,e){var r=t*e;return 1-Math.exp(-r*r)}(e,r)*n}return 0}var Do=Math.PI/2;function No(t){var e=Oo()(t,3),r=e[0],n=e[1],i=e[2],o=I(r),a=I(n),s=1+i/6378137,u=s*Math.cos(a);return[r=u*Math.cos(o),n=u*Math.sin(o),i=s*Math.sin(a)]}function Io(t,e){var r=Oo()(t,3),n=r[0],i=r[1],o=r[2],a=void 0===o?0:o,s=Oo()(e,3),u=s[0],c=s[1],h=s[2],l=No([u,c,void 0===h?0:h]),f=No([n,i,a]),y=f[0]-l[0],p=f[1]-l[1],v=f[2]-l[2];return y*y+p*p+v*v}function Lo(t,e){var r=e.viewport,n=t.header.mbs[1],i=[t.header.mbs[0],n,t.header.mbs[2]],o=t.header.mbs[3]/6378137,a=Io(r.unprojectPosition(r.cameraPosition),i)-o*o;if(a<=0)return 170141175e30;var s=function(t,e){var r=e.viewport,n=r.width,i=r.height,o=r.pixelProjectionMatrix,a=Math.tan(Math.atan(Math.sqrt(1/(o[0]*o[0])+1/(o[5]*o[5]))));return Math.sqrt(i*i+n*n)/a}(0,e);return s*=o/Math.sqrt(a)/r.scale}function qo(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function Vo(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?qo(Object(r),!0).forEach((function(e){c()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):qo(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var zo=new Mt;var Uo=function(){function t(e,r,n){l()(this,t),ae("object"===Yr()(r)),this.header=r,this.tileset=e,this.id=r.id,this.url=r.url,this.parent=n,this.refine=this._getRefine(r.refine),this.type=r.type,this.contentUrl=r.contentUrl,this.lodMetricType=null,this.lodMetricValue=null,this.boundingVolume=null,this.content=null,this.contentState=bo.UNLOADED,this.gpuMemoryUsageInBytes=0,this.children=[],this.depth=0,this._cacheNode=null,this._frameNumber=null,this._cacheNode=null,this._initializeLodMetric(r),this._initializeTransforms(r),this._initializeBoundingVolumes(r),this._initializeContent(r),this._initializeRenderingState(r),this._lodJudge=null,this._expireDate=null,this._expiredContent=null,this._getPriority=this._getPriority.bind(this),Object.seal(this)}var e;return y()(t,[{key:"destroy",value:function(){this.header=null}},{key:"isDestroyed",value:function(){return null===this.header}},{key:"getScreenSpaceError",value:function(t,e){switch(this.tileset.type){case _o.I3S:return Lo(this,t);case _o.TILES3D:return function(t,e,r){var n=t.tileset,i=t.parent&&t.parent.lodMetricValue||t.lodMetricValue,o=r?i:t.lodMetricValue;if(0===o)return 0;var a=Math.max(t._distanceToCamera,1e-7),s=o*e.height/(a*e.sseDenominator);return s-=Co(n,a)}(this,t,e);default:return console.error("Unsupported tileset type"),null}}},{key:"_getPriority",value:function(){return this.isVisible?this.contentState===bo.UNLOADED?-1:Math.max(1e7-this._priority,0)||0:-1}},{key:"loadContent",value:(e=s()(o.a.mark((function t(){var e,r,i,a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.hasEmptyContent){t.next=2;break}return t.abrupt("return",!1);case 2:if(!this.content){t.next=4;break}return t.abrupt("return",!0);case 4:return this.contentExpired&&(this._expireDate=null),this.contentState=bo.LOADING,t.next=9,this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority);case 9:if(e=t.sent){t.next=13;break}return this.contentState=bo.UNLOADED,t.abrupt("return",!1);case 13:return t.prev=13,r=this.tileset.getTileUrl(this.contentUrl),i=this.tileset.fetchOptions,a=this.tileset.loader,s=Vo(Vo({},i),{},c()({},a.id,{tile:this.header,tileset:this.tileset.tileset,isTileset:"auto",isTileHeader:!1,assetGltfUpAxis:this.tileset.asset.gltfUpAxis})),t.next=20,mo(r,a,s);case 20:return this.content=t.sent,this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this,n.dirname(this.contentUrl)),this.contentState=bo.READY,this._onContentLoaded(),t.abrupt("return",!0);case 27:throw t.prev=27,t.t0=t.catch(13),this.contentState=bo.FAILED,t.t0;case 31:return t.prev=31,e.done(),t.finish(31);case 34:case"end":return t.stop()}}),t,this,[[13,27,31,34]])}))),function(){return e.apply(this,arguments)})},{key:"unloadContent",value:function(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.contentState=bo.UNLOADED,!0}},{key:"updateVisibility",value:function(t){if(this._frameNumber!==t.frameNumber){var e=this.parent,r=e?e.computedTransform:this.tileset.modelMatrix,n=e?e._visibilityPlaneMask:Er.MASK_INDETERMINATE;this._updateTransform(r),this._distanceToCamera=this.distanceToTile(t),this._screenSpaceError=this.getScreenSpaceError(t,!1),this._visibilityPlaneMask=this.visibility(t,n),this._visible=this._visibilityPlaneMask!==Er.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(t),this._priority=this.lodMetricValue,this._frameNumber=t.frameNumber}}},{key:"visibility",value:function(t,e){var r=t.cullingVolume,n=this.boundingVolume;return r.computeVisibilityWithPlaneMask(n,e)}},{key:"contentVisibility",value:function(t){return!0}},{key:"distanceToTile",value:function(t){var e=this.boundingVolume;return Math.sqrt(Math.max(e.distanceSquaredTo(t.camera.position),0))}},{key:"cameraSpaceZDepth",value:function(t){var e=t.camera,r=this.boundingVolume;return zo.subVectors(r.center,e.position),e.direction.dot(zo)}},{key:"insideViewerRequestVolume",value:function(t){var e=this._viewerRequestVolume;return!e||0===e.distanceToCamera(t)}},{key:"_initializeLodMetric",value:function(t){"lodMetricType"in t?this.lodMetricType=t.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in t?this.lodMetricValue=t.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}},{key:"_initializeTransforms",value:function(t){this.transform=t.transform?new _t(t.transform):new _t;var e=this.parent,r=this.tileset,n=e&&e.computedTransform?e.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new _t(n).multiplyRight(this.transform);var i=e&&e._initialTransform?e._initialTransform.clone():new _t;this._initialTransform=new _t(i).multiplyRight(this.transform)}},{key:"_initializeBoundingVolumes",value:function(t){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(t)}},{key:"_initializeContent",value:function(t){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=bo.UNLOADED,this.hasTilesetContent=!1,t.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}},{key:"_initializeRenderingState",value:function(t){this.depth=t.level,this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=Er.MASK_INDETERMINATE,this._visible=!1,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}},{key:"_getRefine",value:function(t){return t||this.parent&&this.parent.refine||ko.REPLACE}},{key:"_isTileset",value:function(){return-1!==this.contentUrl.indexOf(".json")}},{key:"_onContentLoaded",value:function(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset.traverser.disableSkipLevelOfDetail=!0}this._isTileset()&&(this.hasTilesetContent=!0)}},{key:"_updateBoundingVolume",value:function(t){this.boundingVolume=Ro(t.boundingVolume,this.computedTransform,this.boundingVolume);var e=t.content;e&&(e.boundingVolume&&(this._contentBoundingVolume=Ro(e.boundingVolume,this.computedTransform,this._contentBoundingVolume)),t.viewerRequestVolume&&(this._viewerRequestVolume=Ro(t.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}},{key:"_updateTransform",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new _t,e=t.clone().multiplyRight(this.transform),r=!e.equals(this.computedTransform);r&&(this.computedTransform=e,this._updateBoundingVolume(this.header))}},{key:"updateExpiration",value:function(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){var t=Date.now();Date.lessThan(this._expireDate,t)&&(this.contentState=bo.EXPIRED,this._expiredContent=this.content)}}},{key:"selected",get:function(){return this._selectedFrame===this.tileset._frameNumber}},{key:"isVisible",get:function(){return this._visible}},{key:"isVisibleAndInRequestVolume",get:function(){return this._visible&&this._inRequestVolume}},{key:"hasRenderContent",get:function(){return!this.hasEmptyContent&&!this.hasTilesetContent}},{key:"hasChildren",get:function(){return this.children.length>0||this.header.children&&this.header.children.length>0}},{key:"contentReady",get:function(){return this.contentState===bo.READY||this.hasEmptyContent}},{key:"contentAvailable",get:function(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}},{key:"hasUnloadedContent",get:function(){return this.hasRenderContent&&this.contentUnloaded}},{key:"contentUnloaded",get:function(){return this.contentState===bo.UNLOADED}},{key:"contentExpired",get:function(){return this.contentState===bo.EXPIRED}},{key:"contentFailed",get:function(){return this.contentState===bo.FAILED}},{key:"extras",get:function(){return this.header.extras}}]),t}(),Fo=r(17),Wo=r.n(Fo),Bo=r(18),Go=r.n(Bo),Qo=r(12),Yo=r.n(Qo),Ko=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;l()(this,t),this._array=new Array(e),this._map=new Map,this._length=e}return y()(t,[{key:"get",value:function(t){return ae(t<this._array.length),this._array[t]}},{key:"set",value:function(t,e){ae(t>=0),t>=this.length&&(this.length=t+1),this._map.has(this._array[t])&&this._map.delete(this._array[t]),this._array[t]=e,this._map.set(e,t)}},{key:"delete",value:function(t){var e=this._map.get(t);e>=0&&(this._array.splice(e,1),this._map.delete(t),this.length--)}},{key:"peek",value:function(){return this._array[this._length-1]}},{key:"push",value:function(t){if(!this._map.has(t)){var e=this.length++;this._array[e]=t,this._map.set(t,e)}}},{key:"pop",value:function(){var t=this._array[--this.length];return this._map.delete(t),t}},{key:"reserve",value:function(t){ae(t>=0),t>this._array.length&&(this._array.length=t)}},{key:"resize",value:function(t){ae(t>=0),this.length=t}},{key:"trim",value:function(t){null==t&&(t=this.length),this._array.length=t}},{key:"reset",value:function(){this._array=[],this._map=new Map,this._length=0}},{key:"find",value:function(t){return this._map.has(t)}},{key:"length",get:function(){return this._length},set:function(t){this._length=t,t>this._array.length&&(this._array.length=t)}},{key:"values",get:function(){return this._array}}]),t}();function Zo(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return Xo(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xo(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function Xo(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ho(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function $o(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?Ho(Object(r),!0).forEach((function(e){c()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ho(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var Jo={loadSiblings:!1,skipLevelOfDetail:!1,maximumScreenSpaceError:2},ta=function(){function t(e){l()(this,t),this.options=$o($o({},Jo),e),this._traversalStack=new Ko,this._emptyTraversalStack=new Ko,this._frameNumber=null,this.root=null,this.selectedTiles={},this.requestedTiles={},this.emptyTiles={}}return y()(t,[{key:"traverse",value:function(t,e,r){this.root=t,this.options=$o($o({},this.options),r),this.reset(),this.updateTile(t,e),this._frameNumber=e.frameNumber,this.executeTraversal(t,e)}},{key:"reset",value:function(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}},{key:"executeTraversal",value:function(t,e){var r=this._traversalStack;for(r.push(t);r.length>0;){var n=r.pop(),i=!1;this.canTraverse(n,e)&&(this.updateChildTiles(n,e),i=this.updateAndPushChildren(n,e,r));var o=n.parent,a=Boolean(!o||o._shouldRefine),s=!i;n.hasRenderContent?n.refine===ko.ADD?(this.loadTile(n,e),this.selectTile(n,e)):n.refine===ko.REPLACE&&(this.loadTile(n,e),s&&this.selectTile(n,e)):(this.emptyTiles[n.id]=n,this.loadTile(n,e),s&&this.selectTile(n,e)),this.touchTile(n,e),n._shouldRefine=i&&a}this.options.onTraversalEnd&&this.options.onTraversalEnd(e)}},{key:"updateChildTiles",value:function(t,e){var r,n=Zo(t.children);try{for(n.s();!(r=n.n()).done;){var i=r.value;this.updateTile(i,e)}}catch(t){n.e(t)}finally{n.f()}return!0}},{key:"updateAndPushChildren",value:function(t,e,r){var n=this.options,i=n.loadSiblings,o=n.skipLevelOfDetail,a=t.children;a.sort(this.compareDistanceToCamera);var s,u=!o&&t.refine===ko.REPLACE&&t.hasRenderContent,c=!1,h=Zo(a);try{for(h.s();!(s=h.n()).done;){var l=s.value;if(l.isVisibleAndInRequestVolume?(r.find(l)&&r.delete(l),r.push(l),c=!0):(u||i)&&(this.loadTile(l,e),this.touchTile(l,e)),u){var f=void 0;if(!(f=!!l._inRequestVolume&&(l.hasRenderContent?l.contentAvailable:this.executeEmptyTraversal(l,e))))return f}}}catch(t){h.e(t)}finally{h.f()}return c}},{key:"updateTile",value:function(t,e){this.updateTileVisibility(t,e)}},{key:"selectTile",value:function(t,e){this.shouldSelectTile(t,e)&&(t._selectedFrame=e.frameNumber,this.selectedTiles[t.id]=t)}},{key:"loadTile",value:function(t,e){this.shouldLoadTile(t,e)&&(t._requestedFrame=e.frameNumber,t._priority=this.getPriority(t),this.requestedTiles[t.id]=t)}},{key:"touchTile",value:function(t,e){t.tileset._cache.touch(t),t._touchedFrame=e.frameNumber}},{key:"canTraverse",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return!(!n&&!t.isVisibleAndInRequestVolume)&&(!!t.hasChildren&&(t.hasTilesetContent?!t.contentExpired:this.shouldRefine(t,e,r)))}},{key:"shouldLoadTile",value:function(t,e){return t.hasUnloadedContent||t.contentExpired}},{key:"shouldSelectTile",value:function(t,e){return t.contentAvailable&&!this.options.skipLevelOfDetail}},{key:"shouldRefine",value:function(t,e,r){var n=t._screenSpaceError;return r&&(n=t.getScreenSpaceError(e,!0)),n>this.options.maximumScreenSpaceError}},{key:"updateTileVisibility",value:function(t,e){t.updateVisibility(e)}},{key:"compareDistanceToCamera",value:function(t,e){return t._distanceToCamera-e._distanceToCamera}},{key:"getPriority",value:function(t){var e=this.options;switch(t.refine){case ko.ADD:return t._distanceToCamera;case ko.REPLACE:var r=t.parent,n=r&&(!e.skipLevelOfDetail||0===t._screenSpaceError||r.hasTilesetContent)?r._screenSpaceError:t._screenSpaceError;return this.root._screenSpaceError-n;default:return ae(!1)}}},{key:"anyChildrenVisible",value:function(t,e){var r,n=!1,i=Zo(t.children);try{for(i.s();!(r=i.n()).done;){var o=r.value;o.updateVisibility(e),n=n||o.isVisibleAndInRequestVolume}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"executeEmptyTraversal",value:function(t,e){for(var r=!0,n=this._emptyTraversalStack;n.length>0;){var i=n.pop();this.updateTile(i,e),i.isVisibleAndInRequestVolume||(this.loadTile(i,e),this.touchTile(i,e));var o=!i.hasRenderContent&&this.canTraverse(i,e,!1,!0);if(o||i.contentAvailable||(r=!1),o){var a,s=Zo(i.children.filter((function(t){return t})));try{for(s.s();!(a=s.n()).done;){var u=a.value;n.find(u)&&n.delete(u),n.push(u)}}catch(t){s.e(t)}finally{s.f()}}}return r}}]),t}();function ea(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Yo()(t);if(e){var i=Yo()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Go()(this,r)}}var ra=function(t){Wo()(r,t);var e=ea(r);function r(){return l()(this,r),e.apply(this,arguments)}return y()(r,[{key:"compareDistanceToCamera",value:function(t,e){return 0===e._distanceToCamera&&0===t._distanceToCamera?e._centerZDepth-t._centerZDepth:e._distanceToCamera-t._distanceToCamera}},{key:"updateTileVisibility",value:function(t,e){if(t.updateVisibility(e),t.isVisibleAndInRequestVolume){var r=t.children.length>0;if(t.hasTilesetContent&&r){var n=t.children[0];return this.updateTileVisibility(n,e),void(t._visible=n._visible)}if(this.meetsScreenSpaceErrorEarly(t,e))t._visible=!1;else{var i=t.refine===ko.REPLACE,o=t._optimChildrenWithinParent===So;i&&o&&r&&!this.anyChildrenVisible(t,e)&&(t._visible=!1)}}}},{key:"meetsScreenSpaceErrorEarly",value:function(t,e){var r=t.parent;return!(!r||r.hasTilesetContent||r.refine!==ko.ADD)&&!this.shouldRefine(t,e,!0)}}]),r}(ta),na="REQUESTED",ia="COMPLETED",oa="ERROR",aa=function(){function t(){l()(this,t),this._statusMap={}}return y()(t,[{key:"add",value:function(t,e,r,n){var i=this;this._statusMap[e]||(this._statusMap[e]={request:t,callback:r,key:e,frameState:n,status:na},t().then((function(t){i._statusMap[e].status=ia,i._statusMap[e].callback(t,n)})).catch((function(t){i._statusMap[e].status=oa,r(t)})))}},{key:"update",value:function(t,e){this._statusMap[t]&&(this._statusMap[t].frameState=e)}},{key:"find",value:function(t){return this._statusMap[t]}}]),t}();function sa(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function ua(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?sa(Object(r),!0).forEach((function(e){c()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):sa(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function ca(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return ha(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ha(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function ha(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function la(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Yo()(t);if(e){var i=Yo()(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Go()(this,r)}}var fa=function(t){Wo()(n,t);var e,r=la(n);function n(t){var e;return l()(this,n),(e=r.call(this,t))._tileManager=new aa,e}return y()(n,[{key:"shouldRefine",value:function(t,e){return t._lodJudge=function(t,e){var r=e.viewport,n=r.metersPerPixel,i=t.header.mbs[1],o=t.header.mbs[0],a=t.header.mbs[2],s=t.header.mbs[3],u=r.height,c=r.width,h=r.latitude,l=r.longitude,f=[l,h],y=[o,i,a],p=[l,i],v=[o,h],d=Math.sqrt(u*u+c*c)*n[0],m=.5*u+s/6378137,g=.5*c+s/6378137;if(Io(f,y)>d+s/6378137)return"OUT";if(Io(f,p)>m)return"OUT";if(Io(f,v)>g)return"OUT";if(0===t.lodMetricValue)return"DIG";var b=Lo(t,e);return(b*=Do)<.5?"OUT":!t.header.children||b<=t.lodMetricValue?"DRAW":t.header.children?"DIG":"OUT"}(t,e),"DIG"===t._lodJudge}},{key:"updateChildTiles",value:function(t,e){var r,n=this,i=t.header.children||[],o=t.children,a=t.tileset,s=ca(i);try{var u=function(){var i=r.value,s=o&&o.find((function(t){return t.id===i.id}));if(s)s&&n.updateTile(s,e);else{var u=function(){return n._loadTile(i.id,a)};n._tileManager.find(i.id)?n._tileManager.update(i.id,e):(a.tileset.nodePages&&(u=function(){return a.tileset.nodePagesTile.formTileFromNodePages(i.id)}),n._tileManager.add(u,i.id,(function(e){return n._onTileLoad(e,t)}),e))}};for(s.s();!(r=s.n()).done;)u()}catch(t){s.e(t)}finally{s.f()}}},{key:"_loadTile",value:(e=s()(o.a.mark((function t(e,r){var n,i,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.loader,i=r.getTileUrl("".concat(r.url,"/nodes/").concat(e)),a={i3s:ua(ua({},r.fetchOptions),{},{isTileHeader:!0,loadContent:!1})},t.next=5,mo(i,n,a);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)}))),function(t,r){return e.apply(this,arguments)})},{key:"_onTileLoad",value:function(t,e){var r=this.options.basePath,n=new Uo(e.tileset,t,e,r);e.children.push(n);var i=this._tileManager.find(n.id).frameState;this.updateTile(n,i),this._frameNumber===i.frameNumber&&this.executeTraversal(n,i)}}]),n}(ta);function ya(t,e){var r;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(r=function(t,e){if(!t)return;if("string"==typeof t)return pa(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pa(t,e)}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=t[Symbol.iterator]()},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function pa(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function va(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function da(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?va(Object(r),!0).forEach((function(e){c()(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):va(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}var ma={ellipsoid:re.WGS84,modelMatrix:new _t,throttleRequests:!1,maximumMemoryUsage:32,onTileLoad:function(){},onTileUnload:function(){},onTileError:function(t,e,r){},maximumScreenSpaceError:8},ga=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l()(this,t),ae(e),this.options=da(da({},ma),r),this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||n.dirname(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.fetchOptions=this.options.fetchOptions||{},this.options.headers&&(this.fetchOptions.headers=this.options.headers),this.options.token&&(this.fetchOptions.token=this.options.token),this.root=null,this.cartographicCenter=null,this.cartesianCenter=null,this.zoom=1,this.boundingVolume=null,this._traverser=this._initializeTraverser(),this._cache=new ve,this._requestScheduler=new le({throttleRequests:this.options.throttleRequests}),this._frameNumber=0,this._updateFrameNumber=0,this._pendingCount=0,this._tiles={},this.selectedTiles=[],this._emptyTiles=[],this._requestedTiles=[],this._selectedTilesToStyle=[],this._queryParams={},this._queryParamsString=null,this.maximumMemoryUsage=this.options.maximumMemoryUsage,this.gpuMemoryUsageInBytes=0,this.stats=new oe({id:this.url}),this._initializeStats(),this._hasMixedContent=!1,this._maximumScreenSpaceError=this.options.maximumScreenSpaceError,this._properties=void 0,this._extensionsUsed=void 0,this._gltfUpAxis=void 0,this._dynamicScreenSpaceErrorComputedDensity=0,this.extras=null,this.asset={},this.credits={},this.description=this.options.description,this._defaultGeometrySchema=[],this._initializeTileSet(e,this.options)}var e;return y()(t,[{key:"isLoaded",value:function(){return 0===this._pendingCount}},{key:"destroy",value:function(){this._destroy()}},{key:"getTileUrl",value:function(t){return t.startsWith("data:")?t:"".concat(t).concat(this.queryParams)}},{key:"update",value:function(t){this._cache.reset(),this._frameNumber++,this._frameState=Br(t,this._frameNumber),this._traverser.traverse(this.root,this._frameState,this.options)}},{key:"_onTraversalEnd",value:function(){var t=Object.values(this._traverser.selectedTiles);this._tilesChanged(this.selectedTiles,t)&&this._updateFrameNumber++,this.selectedTiles=t;var e,r=ya(this.selectedTiles);try{for(r.s();!(e=r.n()).done;){var n=e.value;this._tiles[n.id]=n}}catch(t){r.e(t)}finally{r.f()}return this._requestedTiles=Object.values(this._traverser.requestedTiles),this._emptyTiles=Object.values(this._traverser.emptyTiles),this._loadTiles(this._frameState),this._unloadTiles(),this._updateStats(),this._updateFrameNumber}},{key:"_tilesChanged",value:function(t,e){if(t.length!==e.length)return!0;var r=new Set(t.map((function(t){return t.id}))),n=new Set(e.map((function(t){return t.id}))),i=t.filter((function(t){return!n.has(t.id)})).length>0;return i=i||e.filter((function(t){return!r.has(t.id)})).length>0}},{key:"_loadTiles",value:function(t){var e,r=ya(this._requestedTiles);try{for(r.s();!(e=r.n()).done;){var n=e.value;n.contentUnloaded&&this._loadTile(n,t)}}catch(t){r.e(t)}finally{r.f()}}},{key:"_unloadTiles",value:function(){this._cache.unloadTiles(this,(function(t,e){return t._unloadTile(e)}))}},{key:"_updateStats",value:function(){var t,e=0,r=0,n=ya(this.selectedTiles);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.contentAvailable&&(e++,i.content.pointCount&&(r+=i.content.pointCount))}}catch(t){n.e(t)}finally{n.f()}this.stats.get("Tiles In View").count=this.selectedTiles.length,this.stats.get("Tiles To Render").count=e,this.stats.get("Points").count=r}},{key:"_initializeTileSet",value:function(t){this.root=this._initializeTileHeaders(t,null,this.basePath),this.type===_o.TILES3D&&this._initializeCesiumTileset(t),this.type===_o.I3S&&this._initializeI3STileset(t),this._calculateViewProps()}},{key:"_calculateViewProps",value:function(){var t=this.root,e=t.boundingVolume.center;if(!e)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new Mt,void(this.zoom=1);this.cartographicCenter=re.WGS84.cartesianToCartographic(e,new Mt),this.cartesianCenter=e,this.zoom=function(t){var e=t.halfAxes,r=t.radius,n=t.width,i=t.height;if(e){e.getColumn(0,Gr);var o=Gr.len();e.getColumn(1,Gr);var a=Gr.len();e.getColumn(2,Gr);var s=o/2,u=a/2,c=Gr.len()/2;return(Math.log2(6378137/s)+Math.log2(6378137/u)+Math.log2(6356752.314245179/c))/3}return r?Math.log2(6356752.314245179/r):i&&n?(Math.log2(6378137/n)+Math.log2(6378137/i))/2:1}(t.boundingVolume)}},{key:"_initializeStats",value:function(){this.stats.get("Tiles In Tileset(s)"),this.stats.get("Tiles Loading"),this.stats.get("Tiles In Memory"),this.stats.get("Tiles In View"),this.stats.get("Tiles To Render"),this.stats.get("Tiles Loaded"),this.stats.get("Tiles Unloaded"),this.stats.get("Failed Tile Loads"),this.stats.get("Points","memory"),this.stats.get("Tile Memory Use","memory")}},{key:"_initializeTileHeaders",value:function(t,e,r){var n=new Uo(this,t.root,e,r);if(e&&(e.children.push(n),n.depth=e.depth+1),this.type===_o.TILES3D){var i=[];for(i.push(n);i.length>0;){var o=i.pop();this.stats.get("Tiles In Tileset(s)").incrementCount();var a,s=ya(o.header.children||[]);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=new Uo(this,u,o,r);o.children.push(c),c.depth=o.depth+1,i.push(c)}}catch(t){s.e(t)}finally{s.f()}}}return n}},{key:"_initializeTraverser",value:function(){var t;switch(this.type){case _o.TILES3D:t=ra;break;case _o.I3S:t=fa;break;default:t=ta}return new t({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}},{key:"_destroyTileHeaders",value:function(t){this._destroySubtree(t)}},{key:"_loadTile",value:(e=s()(o.a.mark((function t(e,r){var n;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this._onStartTileLoading(),t.next=4,e.loadContent(r);case 4:n=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),this._onTileLoadError(e,t.t0);case 10:return t.prev=10,this._onEndTileLoading(),this._onTileLoad(e,n),t.finish(10);case 14:case"end":return t.stop()}}),t,this,[[0,7,10,14]])}))),function(t,r){return e.apply(this,arguments)})},{key:"_onTileLoadError",value:function(t,e){this.stats.get("Failed Tile Loads").incrementCount();var r=e.message||e.toString(),n=t.url;console.error("A 3D tile failed to load: ".concat(t.url," ").concat(r)),this.options.onTileError(t,r,n)}},{key:"_onTileLoad",value:function(t,e){e&&(t&&t.content&&de(t,t.content),this._addTileToCache(t),this.options.onTileLoad(t))}},{key:"_onStartTileLoading",value:function(){this._pendingCount++,this.stats.get("Tiles Loading").incrementCount()}},{key:"_onEndTileLoading",value:function(){this._pendingCount--,this.stats.get("Tiles Loading").decrementCount()}},{key:"_addTileToCache",value:function(t){this._cache.add(this,t,(function(e){return e._updateCacheStats(t)}))}},{key:"_updateCacheStats",value:function(t){this.stats.get("Tiles Loaded").incrementCount(),this.stats.get("Tiles In Memory").incrementCount(),this.gpuMemoryUsageInBytes+=t.content.byteLength||0,this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes}},{key:"_unloadTile",value:function(t){this.gpuMemoryUsageInBytes-=t.content.byteLength||0,this.stats.get("Tiles In Memory").decrementCount(),this.stats.get("Tiles Unloaded").incrementCount(),this.stats.get("Tile Memory Use").count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(t),t.unloadContent()}},{key:"_destroy",value:function(){var t=[];for(this.root&&t.push(this.root);t.length>0;){var e,r=t.pop(),n=ya(r.children);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.push(i)}}catch(t){n.e(t)}finally{n.f()}this._destroyTile(r)}this.root=null}},{key:"_destroySubtree",value:function(t){var e=t,r=[];for(r.push(e);r.length>0;){var n,i=ya((t=r.pop()).children);try{for(i.s();!(n=i.n()).done;){var o=n.value;r.push(o)}}catch(t){i.e(t)}finally{i.f()}t!==e&&this._destroyTile(t)}e.children=[]}},{key:"_destroyTile",value:function(t){this._cache.unloadTile(this,t),this._unloadTile(t),t.destroy()}},{key:"_initializeCesiumTileset",value:function(t){if(this.asset=t.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version 0.0 or 1.0.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description,this.properties=t.properties,this.geometricError=t.geometricError,this._extensionsUsed=t.extensionsUsed,this.extras=t.extras}},{key:"_initializeI3STileset",value:function(t){"token"in this.options&&(this._queryParams.token=this.options.token),this._defaultGeometrySchema=t.store.defaultGeometrySchema}},{key:"hasExtension",value:function(t){return Boolean(this._extensionsUsed&&this._extensionsUsed.indexOf(t)>-1)}},{key:"tiles",get:function(){return Object.values(this._tiles)}},{key:"queryParams",get:function(){return this._queryParamsString||(this._queryParamsString=function(t){for(var e=[],r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];e.push("".concat(i,"=").concat(t[i]))}switch(e.length){case 0:return"";case 1:return"?".concat(e[0]);default:return"?".concat(e.join("&"))}}(this._queryParams)),this._queryParamsString}}]),t}()}])}));